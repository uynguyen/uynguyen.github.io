<!doctype html>
<html lang="vi"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Phát triển Bluetooth: Callback vs Reactive Programming - Uy Nguyen</title><meta description="Xây dựng ứng dụng Bluetooth Low Energy liên quan đến việc xử lý nhiều thao tác bất đồng bộ: quét, kết nối, khám phá dịch vụ, đọc&amp;#x2F;ghi characteristic, và xử lý ngắt kết nối. Cách tiếp cận dựa trên call"><meta property="og:type" content="blog"><meta property="og:title" content="Phát triển Bluetooth: Callback vs Reactive Programming"><meta property="og:url" content=":year/:month/:day/:title/"><meta property="og:site_name" content="Uy Nguyen"><meta property="og:description" content="Xây dựng ứng dụng Bluetooth Low Energy liên quan đến việc xử lý nhiều thao tác bất đồng bộ: quét, kết nối, khám phá dịch vụ, đọc&amp;#x2F;ghi characteristic, và xử lý ngắt kết nối. Cách tiếp cận dựa trên call"><meta property="og:locale" content="vi_VN"><meta property="article:published_time" content="2026-01-31T03:00:00.000Z"><meta property="article:modified_time" content="2026-01-31T04:00:41.614Z"><meta property="article:author" content="Uy Nguyen"><meta property="article:tag" content="iOS"><meta property="article:tag" content="Android"><meta property="article:tag" content="BLE"><meta property="article:tag" content="RxSwift"><meta property="article:tag" content="RxJava"><meta property="article:tag" content="Reactive"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/Post-Resources/BLEReactive/cover.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://uynguyen.github.io/vi/posts/Bluetooth-Callback-vs-Reactive-Programming.html"},"headline":"Uy Nguyen","image":["https://uynguyen.github.io/Post-Resources/BLEReactive/cover.png"],"datePublished":"2026-01-31T03:00:00.000Z","dateModified":"2026-01-31T04:00:41.614Z","author":{"@type":"Person","name":"Uy Nguyen"},"description":"Xây dựng ứng dụng Bluetooth Low Energy liên quan đến việc xử lý nhiều thao tác bất đồng bộ: quét, kết nối, khám phá dịch vụ, đọc&#x2F;ghi characteristic, và xử lý ngắt kết nối. Cách tiếp cận dựa trên call"}</script><link rel="canonical" href="https://uynguyen.github.io/vi/posts/Bluetooth-Callback-vs-Reactive-Programming.html"><link rel="icon" href="/Post-Resources/UyNguyen.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><meta property="og:image" content="/Post-Resources/BLEReactive/cover.png"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-163508356-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-163508356-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><div class="navbar-item has-dropdown is-hoverable language-switcher is-hidden-mobile"><a class="navbar-link" title="Language"><i class="fas fa-globe"></i></a><div class="navbar-dropdown is-right"><a class="navbar-item" href="/2026/01/31/Bluetooth-Callback-vs-Reactive-Programming/">English</a><a class="navbar-item is-active" href="/vi/posts/Bluetooth-Callback-vs-Reactive-Programming/">Tiếng Việt</a><a class="navbar-item" href="/es/posts/Bluetooth-Callback-vs-Reactive-Programming/">Español</a></div></div><a class="navbar-item search is-hidden-mobile" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><div class="mobile-toolbar is-hidden-tablet"><div class="container"><div class="mobile-toolbar-content"><button class="mobile-toolbar-btn" id="mobile-lang-btn" title="Language"><i class="fas fa-globe"></i><span>Tiếng Việt</span></button><button class="mobile-toolbar-btn search" title="Search"><i class="fas fa-search"></i><span>Search</span></button></div></div></div><div class="language-picker-overlay" id="lang-picker-overlay"><div class="language-picker-backdrop"></div><div class="language-picker-modal"><div class="language-picker-header"><span>Language</span><button class="language-picker-close" id="lang-picker-close"><i class="fas fa-times"></i></button></div><div class="language-picker-options"><a class="language-picker-option" href="/2026/01/31/Bluetooth-Callback-vs-Reactive-Programming/"><span class="lang-name">English</span></a><a class="language-picker-option is-active" href="/vi/posts/Bluetooth-Callback-vs-Reactive-Programming/"><span class="lang-name">Tiếng Việt</span><i class="fas fa-check"></i></a><a class="language-picker-option" href="/es/posts/Bluetooth-Callback-vs-Reactive-Programming/"><span class="lang-name">Español</span></a></div></div></div><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"></div></div><h1 class="title is-3 is-size-4-mobile">Phát triển Bluetooth: Callback vs Reactive Programming</h1><div class="content"><p><img src="/Post-Resources/BLEReactive/cover.png" alt="" title="Banner"></p>
<p>Xây dựng ứng dụng Bluetooth Low Energy liên quan đến việc xử lý nhiều thao tác bất đồng bộ: quét, kết nối, khám phá dịch vụ, đọc/ghi characteristic, và xử lý ngắt kết nối. Cách tiếp cận dựa trên callback truyền thống có thể nhanh chóng trở nên khó quản lý, dẫn đến điều mà các nhà phát triển gọi là “callback hell”. Trong bài viết này, chúng ta sẽ so sánh cách tiếp cận callback với lập trình reactive sử dụng RxSwift và RxJava, và khám phá cách các pattern reactive có thể cải thiện đáng kể code BLE của bạn.</p>
<a id="more"></a>

<h2 id="Thach-thuc-cua-phat-trien-BLE"><a href="#Thach-thuc-cua-phat-trien-BLE" class="headerlink" title="Thách thức của phát triển BLE"></a>Thách thức của phát triển BLE</h2><p>Các thao tác Bluetooth Low Energy vốn dĩ là bất đồng bộ. Một luồng điển hình để đọc giá trị characteristic bao gồm:</p>
<ol>
<li>Bắt đầu quét thiết bị</li>
<li>Kết nối đến peripheral được phát hiện</li>
<li>Khám phá services</li>
<li>Khám phá characteristics</li>
<li>Đọc giá trị characteristic</li>
<li>Xử lý lỗi tiềm ẩn ở mỗi bước</li>
</ol>
<p>Mỗi bước phụ thuộc vào bước trước hoàn thành thành công, tạo ra một chuỗi các thao tác phụ thuộc cần được điều phối cẩn thận.</p>
<h2 id="Cach-tiep-can-Callback"><a href="#Cach-tiep-can-Callback" class="headerlink" title="Cách tiếp cận Callback"></a>Cách tiếp cận Callback</h2><p>Hãy bắt đầu bằng cách xem xét cách chúng ta triển khai một luồng BLE hoàn chỉnh sử dụng pattern delegate/callback truyền thống trong iOS.</p>
<h3 id="iOS-voi-CoreBluetooth-Delegates"><a href="#iOS-voi-CoreBluetooth-Delegates" class="headerlink" title="iOS với CoreBluetooth Delegates"></a>iOS với CoreBluetooth Delegates</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CoreBluetooth</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallbackBLEManager</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> centralManager: <span class="type">CBCentralManager!</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> targetPeripheral: <span class="type">CBPeripheral?</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> targetCharacteristic: <span class="type">CBCharacteristic?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Callbacks cho mỗi thao tác</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> scanCompletion: ((<span class="type">CBPeripheral?</span>, <span class="type">Error?</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> connectCompletion: ((<span class="type">Error?</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> discoverServicesCompletion: (([<span class="type">CBService</span>]?, <span class="type">Error?</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> discoverCharacteristicsCompletion: (([<span class="type">CBCharacteristic</span>]?, <span class="type">Error?</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> readValueCompletion: ((<span class="type">Data?</span>, <span class="type">Error?</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> targetServiceUUID = <span class="type">CBUUID</span>(string: <span class="string">"180D"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> targetCharacteristicUUID = <span class="type">CBUUID</span>(string: <span class="string">"2A37"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        centralManager = <span class="type">CBCentralManager</span>(delegate: <span class="keyword">self</span>, queue: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hàm chính để đọc nhịp tim</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readHeartRate</span><span class="params">(completion: @escaping <span class="params">(Int?, Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="comment">// Bước 1: Quét thiết bị</span></span><br><span class="line">        scanForDevice &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] peripheral, error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span>, <span class="keyword">let</span> peripheral = peripheral <span class="keyword">else</span> &#123;</span><br><span class="line">                completion(<span class="literal">nil</span>, error ?? <span class="type">BLEError</span>.deviceNotFound)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Bước 2: Kết nối đến thiết bị</span></span><br><span class="line">            <span class="keyword">self</span>.connect(to: peripheral) &#123; error <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> error == <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                    completion(<span class="literal">nil</span>, error)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Bước 3: Khám phá services</span></span><br><span class="line">                <span class="keyword">self</span>.discoverServices(<span class="keyword">for</span>: peripheral) &#123; services, error <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> services = services, error == <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                        completion(<span class="literal">nil</span>, error)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> heartRateService = services.first(<span class="keyword">where</span>: &#123;</span><br><span class="line">                        $<span class="number">0</span>.uuid == <span class="keyword">self</span>.targetServiceUUID</span><br><span class="line">                    &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">                        completion(<span class="literal">nil</span>, <span class="type">BLEError</span>.serviceNotFound)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Bước 4: Khám phá characteristics</span></span><br><span class="line">                    <span class="keyword">self</span>.discoverCharacteristics(<span class="keyword">for</span>: heartRateService,</span><br><span class="line">                                                 peripheral: peripheral) &#123; characteristics, error <span class="keyword">in</span></span><br><span class="line">                        <span class="keyword">guard</span> <span class="keyword">let</span> characteristics = characteristics, error == <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                            completion(<span class="literal">nil</span>, error)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">guard</span> <span class="keyword">let</span> heartRateChar = characteristics.first(<span class="keyword">where</span>: &#123;</span><br><span class="line">                            $<span class="number">0</span>.uuid == <span class="keyword">self</span>.targetCharacteristicUUID</span><br><span class="line">                        &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">                            completion(<span class="literal">nil</span>, <span class="type">BLEError</span>.characteristicNotFound)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Bước 5: Đọc giá trị</span></span><br><span class="line">                        <span class="keyword">self</span>.readValue(<span class="keyword">for</span>: heartRateChar,</span><br><span class="line">                                      peripheral: peripheral) &#123; data, error <span class="keyword">in</span></span><br><span class="line">                            <span class="keyword">guard</span> <span class="keyword">let</span> data = data, error == <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                                completion(<span class="literal">nil</span>, error)</span><br><span class="line">                                <span class="keyword">return</span></span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">let</span> heartRate = <span class="keyword">self</span>.parseHeartRate(from: data)</span><br><span class="line">                            completion(heartRate, <span class="literal">nil</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">scanForDevice</span><span class="params">(completion: @escaping <span class="params">(CBPeripheral?, Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        scanCompletion = completion</span><br><span class="line">        centralManager.scanForPeripherals(withServices: [targetServiceUUID], options: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Timeout sau 10 giây</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">10</span>) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>?.scanCompletion != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>?.centralManager.stopScan()</span><br><span class="line">                <span class="keyword">self</span>?.scanCompletion?(<span class="literal">nil</span>, <span class="type">BLEError</span>.scanTimeout)</span><br><span class="line">                <span class="keyword">self</span>?.scanCompletion = <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">connect</span><span class="params">(to peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                        completion: @escaping <span class="params">(Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        connectCompletion = completion</span><br><span class="line">        targetPeripheral = peripheral</span><br><span class="line">        centralManager.connect(peripheral, options: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">discoverServices</span><span class="params">(<span class="keyword">for</span> peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  completion: @escaping <span class="params">([CBService]?, Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        discoverServicesCompletion = completion</span><br><span class="line">        peripheral.delegate = <span class="keyword">self</span></span><br><span class="line">        peripheral.discoverServices([targetServiceUUID])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">discoverCharacteristics</span><span class="params">(<span class="keyword">for</span> service: CBService,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         completion: @escaping <span class="params">([CBCharacteristic]?, Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        discoverCharacteristicsCompletion = completion</span><br><span class="line">        peripheral.discoverCharacteristics([targetCharacteristicUUID], <span class="keyword">for</span>: service)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">readValue</span><span class="params">(<span class="keyword">for</span> characteristic: CBCharacteristic,</span></span></span><br><span class="line"><span class="function"><span class="params">                          peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                          completion: @escaping <span class="params">(Data?, Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        readValueCompletion = completion</span><br><span class="line">        targetCharacteristic = characteristic</span><br><span class="line">        peripheral.readValue(<span class="keyword">for</span>: characteristic)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">parseHeartRate</span><span class="params">(from data: Data)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> bytes = [<span class="type">UInt8</span>](data)</span><br><span class="line">        <span class="keyword">if</span> bytes[<span class="number">0</span>] &amp; <span class="number">0x01</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Int</span>(bytes[<span class="number">1</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Int</span>(bytes[<span class="number">1</span>]) | (<span class="type">Int</span>(bytes[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - CBCentralManagerDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CallbackBLEManager</span>: <span class="title">CBCentralManagerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManagerDidUpdateState</span><span class="params">(<span class="number">_</span> central: CBCentralManager)</span></span> &#123;</span><br><span class="line">        <span class="comment">// Xử lý thay đổi trạng thái</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager,</span></span></span><br><span class="line"><span class="function"><span class="params">                       didDiscover peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                       advertisementData: [String: <span class="keyword">Any</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                       rssi RSSI: NSNumber)</span></span> &#123;</span><br><span class="line">        central.stopScan()</span><br><span class="line">        scanCompletion?(peripheral, <span class="literal">nil</span>)</span><br><span class="line">        scanCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager,</span></span></span><br><span class="line"><span class="function"><span class="params">                       didConnect peripheral: CBPeripheral)</span></span> &#123;</span><br><span class="line">        connectCompletion?(<span class="literal">nil</span>)</span><br><span class="line">        connectCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager,</span></span></span><br><span class="line"><span class="function"><span class="params">                       didFailToConnect peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                       error: Error?)</span></span> &#123;</span><br><span class="line">        connectCompletion?(error ?? <span class="type">BLEError</span>.connectionFailed)</span><br><span class="line">        connectCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - CBPeripheralDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CallbackBLEManager</span>: <span class="title">CBPeripheralDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                   didDiscoverServices error: Error?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">            discoverServicesCompletion?(<span class="literal">nil</span>, error)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            discoverServicesCompletion?(peripheral.services, <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        discoverServicesCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                   didDiscoverCharacteristicsFor service: CBService,</span></span></span><br><span class="line"><span class="function"><span class="params">                   error: Error?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">            discoverCharacteristicsCompletion?(<span class="literal">nil</span>, error)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            discoverCharacteristicsCompletion?(service.characteristics, <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        discoverCharacteristicsCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral,</span></span></span><br><span class="line"><span class="function"><span class="params">                   didUpdateValueFor characteristic: CBCharacteristic,</span></span></span><br><span class="line"><span class="function"><span class="params">                   error: Error?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">            readValueCompletion?(<span class="literal">nil</span>, error)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            readValueCompletion?(characteristic.value, <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        readValueCompletion = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">BLEError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> deviceNotFound</span><br><span class="line">    <span class="keyword">case</span> scanTimeout</span><br><span class="line">    <span class="keyword">case</span> connectionFailed</span><br><span class="line">    <span class="keyword">case</span> serviceNotFound</span><br><span class="line">    <span class="keyword">case</span> characteristicNotFound</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Van-de-voi-cach-tiep-can-Callback"><a href="#Van-de-voi-cach-tiep-can-Callback" class="headerlink" title="Vấn đề với cách tiếp cận Callback"></a>Vấn đề với cách tiếp cận Callback</h3><p>Nhìn vào code ở trên, một số vấn đề trở nên rõ ràng:</p>
<ol>
<li><p><strong>Callback Hell</strong>: Các callback lồng nhau trong <code>readHeartRate()</code> tạo ra “kim tự tháp tử thần” khó đọc và bảo trì.</p>
</li>
<li><p><strong>Quản lý trạng thái</strong>: Chúng ta cần nhiều completion handler optional và phải quản lý cẩn thận vòng đời của chúng.</p>
</li>
<li><p><strong>Xử lý lỗi</strong>: Xử lý lỗi lặp đi lặp lại và phân tán khắp code.</p>
</li>
<li><p><strong>Quản lý bộ nhớ</strong>: Rủi ro retain cycle với closures đòi hỏi sử dụng cẩn thận <code>[weak self]</code>.</p>
</li>
<li><p><strong>Xử lý timeout</strong>: Mỗi thao tác cần logic timeout riêng.</p>
</li>
<li><p><strong>Không có khả năng kết hợp</strong>: Các thao tác không thể dễ dàng kết hợp, thử lại, hoặc biến đổi.</p>
</li>
</ol>
<h2 id="Cach-tiep-can-Reactive"><a href="#Cach-tiep-can-Reactive" class="headerlink" title="Cách tiếp cận Reactive"></a>Cách tiếp cận Reactive</h2><h3 id="Lap-trinh-Reactive-la-gi"><a href="#Lap-trinh-Reactive-la-gi" class="headerlink" title="Lập trình Reactive là gì?"></a>Lập trình Reactive là gì?</h3><p>Lập trình Reactive là một mô hình lập trình khai báo tập trung vào các luồng dữ liệu và sự lan truyền thay đổi. Thay vì viết các hướng dẫn từng bước (mệnh lệnh), bạn mô tả <em>những gì</em> bạn muốn xảy ra khi dữ liệu chảy qua hệ thống của bạn.</p>
<p>Hãy nghĩ về nó như việc thiết lập một đường ống: dữ liệu đi vào một đầu, chảy qua các biến đổi khác nhau, và đi ra đầu kia ở dạng bạn cần. Đường ống tự động xử lý luồng, lỗi, và hoàn thành.</p>
<h3 id="Cac-khai-niem-cot-loi"><a href="#Cac-khai-niem-cot-loi" class="headerlink" title="Các khái niệm cốt lõi"></a>Các khái niệm cốt lõi</h3><p><strong>1. Observable (Luồng)</strong><br>Observable đại diện cho một luồng dữ liệu có thể phát ra các giá trị theo thời gian. Nó có thể phát ra:</p>
<ul>
<li><strong>Next</strong>: Một giá trị mới trong luồng</li>
<li><strong>Error</strong>: Một lỗi xảy ra, luồng kết thúc</li>
<li><strong>Complete</strong>: Luồng hoàn thành thành công</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Một Observable phát ra các giá trị nhịp tim theo thời gian</span></span><br><span class="line"><span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;  <span class="comment">// phát ra: 72 -&gt; 75 -&gt; 71 -&gt; 68 -&gt; ...</span></span><br></pre></td></tr></table></figure>

<p><strong>2. Observer (Người đăng ký)</strong><br>Observer đăng ký vào Observable và phản ứng với các giá trị được phát ra:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">heartRateObservable</span><br><span class="line">    .subscribe(</span><br><span class="line">        onNext: &#123; value <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"Nhịp tim: \(value)"</span>) &#125;,</span><br><span class="line">        onError: &#123; error <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"Lỗi: \(error)"</span>) &#125;,</span><br><span class="line">        onComplete: &#123; <span class="built_in">print</span>(<span class="string">"Dừng theo dõi"</span>) &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><strong>3. Operators (Toán tử)</strong><br>Operators biến đổi, lọc, và kết hợp các luồng. Các operator phổ biến bao gồm:</p>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Mục đích</th>
<th>Ví dụ</th>
</tr>
</thead>
<tbody><tr>
<td><code>map</code></td>
<td>Biến đổi mỗi giá trị</td>
<td>Chuyển đổi bytes thô thành nhịp tim</td>
</tr>
<tr>
<td><code>filter</code></td>
<td>Chỉ cho qua các giá trị thỏa điều kiện</td>
<td>Chỉ giá trị &gt; 60 BPM</td>
</tr>
<tr>
<td><code>flatMap</code></td>
<td>Biến đổi thành Observable khác</td>
<td>Kết nối, sau đó khám phá services</td>
</tr>
<tr>
<td><code>take</code></td>
<td>Chỉ lấy N giá trị đầu tiên</td>
<td>Lấy thiết bị đầu tiên được phát hiện</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>Thất bại nếu không có giá trị trong thời gian</td>
<td>Timeout quét sau 10s</td>
</tr>
<tr>
<td><code>retry</code></td>
<td>Thử lại khi có lỗi</td>
<td>Kết nối lại khi bị ngắt</td>
</tr>
<tr>
<td><code>catch</code></td>
<td>Xử lý lỗi một cách nhẹ nhàng</td>
<td>Trả về giá trị mặc định khi có lỗi</td>
</tr>
</tbody></table>
<p><strong>4. Disposable (Quản lý đăng ký)</strong><br>Disposable đại diện cho một đăng ký đang hoạt động. Hủy nó sẽ hủy đăng ký và dọn dẹp tài nguyên:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">observable</span><br><span class="line">    .subscribe(onNext: &#123; value <span class="keyword">in</span> <span class="comment">/* xử lý */</span> &#125;)</span><br><span class="line">    .disposed(by: disposeBag)  <span class="comment">// Tự động hủy khi disposeBag bị deallocate</span></span><br></pre></td></tr></table></figure>

<p><strong>5. Schedulers</strong><br>Schedulers kiểm soát thread/queue nào các thao tác chạy trên:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">observable</span><br><span class="line">    .subscribe(on: <span class="type">ConcurrentDispatchQueueScheduler</span>(qos: .background))  <span class="comment">// Làm việc trên background</span></span><br><span class="line">    .observe(on: <span class="type">MainScheduler</span>.instance)  <span class="comment">// Trả kết quả trên main thread</span></span><br></pre></td></tr></table></figure>

<h3 id="Tai-sao-Reactive-phu-hop-cho-BLE"><a href="#Tai-sao-Reactive-phu-hop-cho-BLE" class="headerlink" title="Tại sao Reactive phù hợp cho BLE?"></a>Tại sao Reactive phù hợp cho BLE?</h3><p>Lập trình reactive đặc biệt phù hợp cho BLE vì:</p>
<ol>
<li><strong>Phù hợp tự nhiên cho các sự kiện bất đồng bộ</strong>: Các thao tác BLE là các luồng sự kiện (kết quả quét, trạng thái kết nối, cập nhật characteristic)</li>
<li><strong>Xử lý lỗi tích hợp</strong>: Các operator như <code>retry</code>, <code>catch</code>, và <code>timeout</code> xử lý các kịch bản lỗi BLE phổ biến</li>
<li><strong>Kết hợp dễ dàng</strong>: Nối chuỗi các thao tác một cách tự nhiên (quét → kết nối → khám phá → đọc)</li>
<li><strong>Dọn dẹp tài nguyên tự động</strong>: Disposables đảm bảo các kết nối và quét được dọn dẹp đúng cách</li>
</ol>
<p>Bây giờ hãy xem lập trình reactive biến đổi code này như thế nào. Chúng ta sẽ sử dụng RxSwift cho iOS và hiển thị các tương đương RxJava cho Android.</p>
<h3 id="iOS-voi-RxSwift-RxBluetoothKit"><a href="#iOS-voi-RxSwift-RxBluetoothKit" class="headerlink" title="iOS với RxSwift + RxBluetoothKit"></a>iOS với RxSwift + RxBluetoothKit</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxBluetoothKit</span><br><span class="line"><span class="keyword">import</span> CoreBluetooth</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReactiveBLEManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> centralManager: <span class="type">CentralManager</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> heartRateServiceUUID = <span class="type">CBUUID</span>(string: <span class="string">"180D"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> heartRateMeasurementUUID = <span class="type">CBUUID</span>(string: <span class="string">"2A37"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        centralManager = <span class="type">CentralManager</span>(queue: .main)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Luồng BLE sạch, khai báo</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readHeartRate</span><span class="params">()</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> centralManager.observeState()</span><br><span class="line">            .startWith(centralManager.state)</span><br><span class="line">            .<span class="built_in">filter</span> &#123; $<span class="number">0</span> == .poweredOn &#125;</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> -&gt; <span class="type">Observable</span>&lt;<span class="type">ScannedPeripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.centralManager.scanForPeripherals(</span><br><span class="line">                    withServices: [<span class="keyword">self</span>.heartRateServiceUUID]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .timeout(.seconds(<span class="number">10</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">            .flatMap &#123; scannedPeripheral -&gt; <span class="type">Observable</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">                scannedPeripheral.peripheral.establishConnection()</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] peripheral -&gt; <span class="type">Observable</span>&lt;<span class="type">Service</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">                <span class="keyword">return</span> peripheral.discoverServices([<span class="keyword">self</span>.heartRateServiceUUID])</span><br><span class="line">                    .flatMap &#123; <span class="type">Observable</span>.from($<span class="number">0</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] service -&gt; <span class="type">Observable</span>&lt;<span class="type">Characteristic</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">                <span class="keyword">return</span> service.discoverCharacteristics([<span class="keyword">self</span>.heartRateMeasurementUUID])</span><br><span class="line">                    .flatMap &#123; <span class="type">Observable</span>.from($<span class="number">0</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; characteristic -&gt; <span class="type">Observable</span>&lt;<span class="type">Characteristic</span>&gt; <span class="keyword">in</span></span><br><span class="line">                characteristic.readValue()</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="built_in">map</span> &#123; characteristic -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> data = characteristic.value <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="type">BLEError</span>.invalidData</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.parseHeartRate(from: data)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Đăng ký cập nhật nhịp tim liên tục</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">observeHeartRate</span><span class="params">()</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> centralManager.observeState()</span><br><span class="line">            .startWith(centralManager.state)</span><br><span class="line">            .<span class="built_in">filter</span> &#123; $<span class="number">0</span> == .poweredOn &#125;</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> -&gt; <span class="type">Observable</span>&lt;<span class="type">ScannedPeripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.centralManager.scanForPeripherals(</span><br><span class="line">                    withServices: [<span class="keyword">self</span>.heartRateServiceUUID]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .timeout(.seconds(<span class="number">10</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">            .flatMap &#123; scannedPeripheral -&gt; <span class="type">Observable</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">                scannedPeripheral.peripheral.establishConnection()</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] peripheral -&gt; <span class="type">Observable</span>&lt;<span class="type">Characteristic</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">                <span class="keyword">return</span> peripheral.discoverServices([<span class="keyword">self</span>.heartRateServiceUUID])</span><br><span class="line">                    .flatMap &#123; <span class="type">Observable</span>.from($<span class="number">0</span>) &#125;</span><br><span class="line">                    .flatMap &#123; service <span class="keyword">in</span></span><br><span class="line">                        service.discoverCharacteristics([<span class="keyword">self</span>.heartRateMeasurementUUID])</span><br><span class="line">                    &#125;</span><br><span class="line">                    .flatMap &#123; <span class="type">Observable</span>.from($<span class="number">0</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .flatMap &#123; characteristic -&gt; <span class="type">Observable</span>&lt;<span class="type">Characteristic</span>&gt; <span class="keyword">in</span></span><br><span class="line">                characteristic.observeValueUpdateAndSetNotification()</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="built_in">map</span> &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] characteristic -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span>, <span class="keyword">let</span> data = characteristic.value <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="type">BLEError</span>.invalidData</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.parseHeartRate(from: data)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">parseHeartRate</span><span class="params">(from data: Data)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> bytes = [<span class="type">UInt8</span>](data)</span><br><span class="line">        <span class="keyword">if</span> bytes[<span class="number">0</span>] &amp; <span class="number">0x01</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Int</span>(bytes[<span class="number">1</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Int</span>(bytes[<span class="number">1</span>]) | (<span class="type">Int</span>(bytes[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sử dụng</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeartRateViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> bleManager = <span class="type">ReactiveBLEManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Đọc một lần</span></span><br><span class="line">        bleManager.readHeartRate()</span><br><span class="line">            .observe(on: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">            .subscribe(</span><br><span class="line">                onNext: &#123; heartRate <span class="keyword">in</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"Nhịp tim: \(heartRate) BPM"</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                onError: &#123; error <span class="keyword">in</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"Lỗi: \(error)"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Theo dõi liên tục với tự động thử lại</span></span><br><span class="line">        bleManager.observeHeartRate()</span><br><span class="line">            .retry(when: &#123; errors <span class="keyword">in</span></span><br><span class="line">                errors.delay(.seconds(<span class="number">5</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">            &#125;)</span><br><span class="line">            .observe(on: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">            .subscribe(onNext: &#123; heartRate <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.updateUI(heartRate: heartRate)</span><br><span class="line">            &#125;)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">updateUI</span><span class="params">(heartRate: Int)</span></span> &#123;</span><br><span class="line">        <span class="comment">// Cập nhật UI</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Android-voi-RxJava-RxAndroidBle"><a href="#Android-voi-RxJava-RxAndroidBle" class="headerlink" title="Android với RxJava + RxAndroidBle"></a>Android với RxJava + RxAndroidBle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.polidea.rxandroidble2.RxBleClient;</span><br><span class="line"><span class="keyword">import</span> com.polidea.rxandroidble2.RxBleConnection;</span><br><span class="line"><span class="keyword">import</span> com.polidea.rxandroidble2.RxBleDevice;</span><br><span class="line"><span class="keyword">import</span> com.polidea.rxandroidble2.scan.ScanSettings;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.CompositeDisposable;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactiveBLEManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UUID HEART_RATE_SERVICE =</span><br><span class="line">        UUID.fromString(<span class="string">"0000180d-0000-1000-8000-00805f9b34fb"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UUID HEART_RATE_MEASUREMENT =</span><br><span class="line">        UUID.fromString(<span class="string">"00002a37-0000-1000-8000-00805f9b34fb"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RxBleClient rxBleClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CompositeDisposable disposables = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReactiveBLEManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        rxBleClient = RxBleClient.create(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Observable&lt;Integer&gt; <span class="title">readHeartRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rxBleClient.scanBleDevices(</span><br><span class="line">                <span class="keyword">new</span> ScanSettings.Builder()</span><br><span class="line">                    .setScanMode(ScanSettings.SCAN_MODE_LOW_LATENCY)</span><br><span class="line">                    .build(),</span><br><span class="line">                <span class="keyword">new</span> ScanFilter.Builder()</span><br><span class="line">                    .setServiceUuid(<span class="keyword">new</span> ParcelUuid(HEART_RATE_SERVICE))</span><br><span class="line">                    .build()</span><br><span class="line">            )</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .timeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">            .map(scanResult -&gt; scanResult.getBleDevice())</span><br><span class="line">            .flatMap(device -&gt; device.establishConnection(<span class="keyword">false</span>))</span><br><span class="line">            .flatMapSingle(connection -&gt;</span><br><span class="line">                connection.readCharacteristic(HEART_RATE_MEASUREMENT)</span><br><span class="line">            )</span><br><span class="line">            .map(<span class="keyword">this</span>::parseHeartRate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Observable&lt;Integer&gt; <span class="title">observeHeartRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rxBleClient.scanBleDevices(</span><br><span class="line">                <span class="keyword">new</span> ScanSettings.Builder()</span><br><span class="line">                    .setScanMode(ScanSettings.SCAN_MODE_LOW_LATENCY)</span><br><span class="line">                    .build(),</span><br><span class="line">                <span class="keyword">new</span> ScanFilter.Builder()</span><br><span class="line">                    .setServiceUuid(<span class="keyword">new</span> ParcelUuid(HEART_RATE_SERVICE))</span><br><span class="line">                    .build()</span><br><span class="line">            )</span><br><span class="line">            .take(<span class="number">1</span>)</span><br><span class="line">            .timeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">            .map(scanResult -&gt; scanResult.getBleDevice())</span><br><span class="line">            .flatMap(device -&gt; device.establishConnection(<span class="keyword">false</span>))</span><br><span class="line">            .flatMap(connection -&gt;</span><br><span class="line">                connection.setupNotification(HEART_RATE_MEASUREMENT)</span><br><span class="line">            )</span><br><span class="line">            .flatMap(observable -&gt; observable)</span><br><span class="line">            .map(<span class="keyword">this</span>::parseHeartRate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parseHeartRate</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((data[<span class="number">0</span>] &amp; <span class="number">0x01</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data[<span class="number">1</span>] &amp; <span class="number">0xFF</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (data[<span class="number">1</span>] &amp; <span class="number">0xFF</span>) | ((data[<span class="number">2</span>] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        disposables.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sử dụng trong Activity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeartRateActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ReactiveBLEManager bleManager;</span><br><span class="line">    <span class="keyword">private</span> CompositeDisposable disposables = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        bleManager = <span class="keyword">new</span> ReactiveBLEManager(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Đọc một lần</span></span><br><span class="line">        disposables.add(</span><br><span class="line">            bleManager.readHeartRate()</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(</span><br><span class="line">                    heartRate -&gt; Log.d(<span class="string">"BLE"</span>, <span class="string">"Nhịp tim: "</span> + heartRate),</span><br><span class="line">                    error -&gt; Log.e(<span class="string">"BLE"</span>, <span class="string">"Lỗi: "</span> + error.getMessage())</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Theo dõi liên tục với thử lại</span></span><br><span class="line">        disposables.add(</span><br><span class="line">            bleManager.observeHeartRate()</span><br><span class="line">                .retryWhen(errors -&gt;</span><br><span class="line">                    errors.delay(<span class="number">5</span>, TimeUnit.SECONDS)</span><br><span class="line">                )</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(</span><br><span class="line">                    heartRate -&gt; updateUI(heartRate),</span><br><span class="line">                    error -&gt; handleError(error)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        disposables.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cac-Pattern-Reactive-nang-cao"><a href="#Cac-Pattern-Reactive-nang-cao" class="headerlink" title="Các Pattern Reactive nâng cao"></a>Các Pattern Reactive nâng cao</h2><p>Lập trình reactive cho phép các pattern mạnh mẽ mà sẽ phức tạp để triển khai với callbacks.</p>
<h3 id="1-Tu-dong-ket-noi-lai"><a href="#1-Tu-dong-ket-noi-lai" class="headerlink" title="1. Tự động kết nối lại"></a>1. Tự động kết nối lại</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectWithAutoReconnect</span><span class="params">(to deviceId: UUID)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Peripheral</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> centralManager.retrievePeripherals(withIdentifiers: [deviceId])</span><br><span class="line">        .flatMap &#123; peripherals -&gt; <span class="type">Observable</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> peripheral = peripherals.first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> .error(<span class="type">BLEError</span>.deviceNotFound)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> peripheral.establishConnection()</span><br><span class="line">        &#125;</span><br><span class="line">        .retry(when: &#123; errors <span class="keyword">in</span></span><br><span class="line">            errors</span><br><span class="line">                .enumerated()</span><br><span class="line">                .flatMap &#123; (attempt, error) -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">guard</span> attempt &lt; <span class="number">5</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> .error(error)</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">let</span> delay = <span class="type">Double</span>(<span class="built_in">min</span>(attempt + <span class="number">1</span>, <span class="number">5</span>)) * <span class="number">2.0</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"Kết nối lại sau \(delay) giây (lần thử \(attempt + 1))"</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.timer(</span><br><span class="line">                        .seconds(<span class="type">Int</span>(delay)),</span><br><span class="line">                        scheduler: <span class="type">MainScheduler</span>.instance</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Doc-nhieu-Characteristics-song-song"><a href="#2-Doc-nhieu-Characteristics-song-song" class="headerlink" title="2. Đọc nhiều Characteristics song song"></a>2. Đọc nhiều Characteristics song song</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readMultipleCharacteristics</span><span class="params">(from peripheral: Peripheral)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">DeviceInfo</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> firmwareChar = <span class="type">CBUUID</span>(string: <span class="string">"2A26"</span>)</span><br><span class="line">    <span class="keyword">let</span> hardwareChar = <span class="type">CBUUID</span>(string: <span class="string">"2A27"</span>)</span><br><span class="line">    <span class="keyword">let</span> serialChar = <span class="type">CBUUID</span>(string: <span class="string">"2A25"</span>)</span><br><span class="line">    <span class="keyword">let</span> deviceInfoService = <span class="type">CBUUID</span>(string: <span class="string">"180A"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> peripheral.discoverServices([deviceInfoService])</span><br><span class="line">        .flatMap &#123; services -&gt; <span class="type">Observable</span>&lt;<span class="type">Service</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> service = services.first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> .error(<span class="type">BLEError</span>.serviceNotFound)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> .just(service)</span><br><span class="line">        &#125;</span><br><span class="line">        .flatMap &#123; service <span class="keyword">in</span></span><br><span class="line">            service.discoverCharacteristics([firmwareChar, hardwareChar, serialChar])</span><br><span class="line">        &#125;</span><br><span class="line">        .flatMap &#123; characteristics -&gt; <span class="type">Observable</span>&lt;<span class="type">DeviceInfo</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> reads = characteristics.<span class="built_in">map</span> &#123; char <span class="keyword">in</span></span><br><span class="line">                char.readValue().<span class="built_in">map</span> &#123; ($<span class="number">0</span>.uuid, $<span class="number">0</span>.value) &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="type">Observable</span>.<span class="built_in">zip</span>(reads) &#123; results <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> firmware = <span class="string">""</span></span><br><span class="line">                <span class="keyword">var</span> hardware = <span class="string">""</span></span><br><span class="line">                <span class="keyword">var</span> serial = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (uuid, data) <span class="keyword">in</span> results &#123;</span><br><span class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> data = data,</span><br><span class="line">                          <span class="keyword">let</span> value = <span class="type">String</span>(data: data, encoding: .utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">switch</span> uuid &#123;</span><br><span class="line">                    <span class="keyword">case</span> firmwareChar: firmware = value</span><br><span class="line">                    <span class="keyword">case</span> hardwareChar: hardware = value</span><br><span class="line">                    <span class="keyword">case</span> serialChar: serial = value</span><br><span class="line">                    <span class="keyword">default</span>: <span class="keyword">break</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="type">DeviceInfo</span>(</span><br><span class="line">                    firmware: firmware,</span><br><span class="line">                    hardware: hardware,</span><br><span class="line">                    serial: serial</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Ghi-voi-xac-nhan-phan-hoi"><a href="#3-Ghi-voi-xac-nhan-phan-hoi" class="headerlink" title="3. Ghi với xác nhận phản hồi"></a>3. Ghi với xác nhận phản hồi</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeWithConfirmation</span><span class="params">(data: Data,</span></span></span><br><span class="line"><span class="function"><span class="params">                           to characteristic: Characteristic)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Bool</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> characteristic.writeValue(data, type: .withResponse)</span><br><span class="line">        .timeout(.seconds(<span class="number">5</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">        .<span class="built_in">map</span> &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="literal">true</span> &#125;</span><br><span class="line">        .<span class="keyword">catch</span> &#123; error <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Ghi thất bại: \(error)"</span>)</span><br><span class="line">            <span class="keyword">return</span> .just(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeSequence</span><span class="params">(commands: [Data],</span></span></span><br><span class="line"><span class="function"><span class="params">                   to characteristic: Characteristic)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.from(commands)</span><br><span class="line">        .enumerated()</span><br><span class="line">        .concatMap &#123; index, data <span class="keyword">in</span></span><br><span class="line">            characteristic.writeValue(data, type: .withResponse)</span><br><span class="line">                .<span class="built_in">map</span> &#123; <span class="number">_</span> <span class="keyword">in</span> index &#125;</span><br><span class="line">                .delay(.milliseconds(<span class="number">100</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-Quet-voi-loc-RSSI"><a href="#4-Quet-voi-loc-RSSI" class="headerlink" title="4. Quét với lọc RSSI"></a>4. Quét với lọc RSSI</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scanForNearbyDevices</span><span class="params">(rssiThreshold: Int = -<span class="number">70</span>)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">ScannedPeripheral</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> centralManager.scanForPeripherals(withServices: <span class="literal">nil</span>)</span><br><span class="line">        .<span class="built_in">filter</span> &#123; $<span class="number">0</span>.rssi.intValue &gt;= rssiThreshold &#125;</span><br><span class="line">        .distinctUntilChanged &#123; $<span class="number">0</span>.peripheral.identifier == $<span class="number">1</span>.peripheral.identifier &#125;</span><br><span class="line">        .buffer(timeSpan: .seconds(<span class="number">2</span>), <span class="built_in">count</span>: <span class="number">100</span>, scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">        .flatMap &#123; peripherals -&gt; <span class="type">Observable</span>&lt;<span class="type">ScannedPeripheral</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// Trả về thiết bị có RSSI tốt nhất</span></span><br><span class="line">            <span class="keyword">let</span> sorted = peripherals.sorted &#123; $<span class="number">0</span>.rssi.intValue &gt; $<span class="number">1</span>.rssi.intValue &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Observable</span>.from(sorted)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Tong-ket-so-sanh"><a href="#Tong-ket-so-sanh" class="headerlink" title="Tổng kết so sánh"></a>Tổng kết so sánh</h2><table>
<thead>
<tr>
<th>Khía cạnh</th>
<th>Callback</th>
<th>Reactive</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Cấu trúc code</strong></td>
<td>Callbacks lồng nhau, kim tự tháp tử thần</td>
<td>Phẳng, các thao tác có thể nối chuỗi</td>
</tr>
<tr>
<td><strong>Xử lý lỗi</strong></td>
<td>Phân tán, lặp lại</td>
<td>Tập trung với <code>.catch</code>, <code>.retry</code></td>
</tr>
<tr>
<td><strong>Kết hợp</strong></td>
<td>Khó khăn</td>
<td>Tự nhiên với operators</td>
</tr>
<tr>
<td><strong>Kiểm thử</strong></td>
<td>Mock phức tạp</td>
<td>Dễ dàng với test schedulers</td>
</tr>
<tr>
<td><strong>Xử lý timeout</strong></td>
<td>Triển khai thủ công</td>
<td>Operator <code>.timeout()</code> có sẵn</td>
</tr>
<tr>
<td><strong>Logic thử lại</strong></td>
<td>Quản lý trạng thái phức tạp</td>
<td>Đơn giản với <code>.retry()</code>, <code>.retryWhen()</code></td>
</tr>
<tr>
<td><strong>Threading</strong></td>
<td>Dispatch thủ công</td>
<td>Khai báo với schedulers</td>
</tr>
<tr>
<td><strong>Quản lý bộ nhớ</strong></td>
<td>Xử lý closure cẩn thận</td>
<td>Tự động với DisposeBag</td>
</tr>
<tr>
<td><strong>Đường cong học tập</strong></td>
<td>Thấp hơn</td>
<td>Đầu tư ban đầu cao hơn</td>
</tr>
<tr>
<td><strong>Debug</strong></td>
<td>Stack traces rõ ràng</td>
<td>Có thể phức tạp</td>
</tr>
</tbody></table>
<h2 id="Khi-nao-su-dung-moi-cach-tiep-can"><a href="#Khi-nao-su-dung-moi-cach-tiep-can" class="headerlink" title="Khi nào sử dụng mỗi cách tiếp cận"></a>Khi nào sử dụng mỗi cách tiếp cận</h2><h3 id="Su-dung-Callbacks-khi"><a href="#Su-dung-Callbacks-khi" class="headerlink" title="Sử dụng Callbacks khi:"></a>Sử dụng Callbacks khi:</h3><ul>
<li>Xây dựng ứng dụng đơn giản với ít thao tác BLE</li>
<li>Team chưa quen với lập trình reactive</li>
<li>Các thao tác BLE đơn lẻ, một lần</li>
<li>Tạo prototype hoặc proof-of-concept</li>
</ul>
<h3 id="Su-dung-Reactive-Programming-khi"><a href="#Su-dung-Reactive-Programming-khi" class="headerlink" title="Sử dụng Reactive Programming khi:"></a>Sử dụng Reactive Programming khi:</h3><ul>
<li>Luồng BLE phức tạp với nhiều thao tác</li>
<li>Cần logic tự động kết nối lại và thử lại</li>
<li>Streaming dữ liệu thời gian thực từ thiết bị</li>
<li>Nhiều thao tác BLE đồng thời</li>
<li>Dự án team lớn đòi hỏi patterns nhất quán</li>
<li>Khả năng bảo trì dài hạn là quan trọng</li>
</ul>
<h2 id="Chien-luoc-di-chuyen"><a href="#Chien-luoc-di-chuyen" class="headerlink" title="Chiến lược di chuyển"></a>Chiến lược di chuyển</h2><p>Nếu bạn đang chuyển từ callbacks sang reactive:</p>
<ol>
<li><strong>Bắt đầu nhỏ</strong>: Bắt đầu với các tính năng mới sử dụng reactive patterns</li>
<li><strong>Bọc code hiện có</strong>: Tạo các wrapper reactive xung quanh code dựa trên callback</li>
<li><strong>Tái cấu trúc dần</strong>: Thay thế các triển khai callback từng cái một</li>
<li><strong>Đào tạo team</strong>: Đầu tư vào giáo dục lập trình reactive</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bọc code dựa trên callback</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CBCentralManager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">rx_scanForPeripherals</span><span class="params">(withServices services: [CBUUID]?)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">CBPeripheral</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// Cầu nối đến quét dựa trên callback</span></span><br><span class="line">            <span class="keyword">let</span> delegate = <span class="type">RxCentralManagerDelegate</span>(observer: observer)</span><br><span class="line">            <span class="keyword">self</span>.delegate = delegate</span><br><span class="line">            <span class="keyword">self</span>.scanForPeripherals(withServices: services, options: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="type">Disposables</span>.create &#123;</span><br><span class="line">                <span class="keyword">self</span>.stopScan()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ket-luan"><a href="#Ket-luan" class="headerlink" title="Kết luận"></a>Kết luận</h2><p>Mặc dù cách tiếp cận callback đơn giản hơn để hiểu ban đầu, lập trình reactive cung cấp những lợi thế đáng kể cho phát triển BLE:</p>
<ul>
<li><strong>Code sạch hơn</strong> đọc như một mô tả về những gì bạn muốn đạt được</li>
<li><strong>Xử lý lỗi tốt hơn</strong> với cơ chế retry và timeout có sẵn</li>
<li><strong>Kết hợp dễ dàng hơn</strong> các luồng bất đồng bộ phức tạp</li>
<li><strong>Cải thiện khả năng kiểm thử</strong> với lập lịch xác định</li>
</ul>
<p>Đường cong học tập ban đầu đáng giá đầu tư cho bất kỳ dự án BLE nghiêm túc nào. Các thư viện như RxBluetoothKit (iOS) và RxAndroidBle (Android) giúp việc chuyển đổi dễ dàng hơn bằng cách cung cấp các wrapper reactive xung quanh các API Bluetooth gốc của nền tảng.</p>
<p>Bắt đầu với các thao tác đơn giản, dần dần áp dụng các pattern nâng cao hơn, và xem code BLE của bạn biến đổi từ callbacks rối rắm thành các reactive streams thanh lịch, dễ bảo trì.</p>
<h2 id="Tai-lieu-tham-khao"><a href="#Tai-lieu-tham-khao" class="headerlink" title="Tài liệu tham khảo"></a>Tài liệu tham khảo</h2><ul>
<li><a href="https://github.com/ReactiveX/RxSwift">Tài liệu RxSwift</a></li>
<li><a href="https://github.com/Polidea/RxBluetoothKit">RxBluetoothKit</a></li>
<li><a href="https://github.com/Polidea/RxAndroidBle">RxAndroidBle</a></li>
<li><a href="http://reactivex.io/documentation">Tài liệu ReactiveX</a></li>
<li><a href="https://developer.apple.com/documentation/corebluetooth">Apple Core Bluetooth</a></li>
</ul>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5e9474199d6bcc0012d5bba6&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://ko-fi.com/uynguyen" style="background-color:rgba(255,128,62,.87);border-color:transparent;color:white;" target="_blank" rel="noopener"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button is-warning donate" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="uynguyen.itus@gmail.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://uynguyen.github.io/vi/posts/Bluetooth-Callback-vs-Reactive-Programming.html';
            this.page.identifier = 'vi/posts/Bluetooth-Callback-vs-Reactive-Programming.html';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'uynguyen-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen"></figure><p class="title is-size-4 is-block line-height-inherit">Uy Nguyen</p><p class="is-size-6 is-block">Software engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-envelope mr-1"></i><span>uynguyen.itus@gmail.com</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">59</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">36</p></a></div></div></nav><div class="level"><a class="level-item button is-rounded" style="background-color:#f14668e3;color:white;font-weight:bold;" href="https://ko-fi.com/uynguyen" target="_blank" rel="noopener">if 👍 then Buy me a Coffee</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/uynguyen"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://www.linkedin.com/in/uynguyen505"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://uynguyen.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Uy Nguyen</span></span><span class="level-right"><span class="level-item tag">uynguyen.github.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2026-01-31T03:00:00.000Z">2026-01-31</time></p><p class="title is-6"><a class="link-muted" href="/2026/01/31/Bluetooth-Callback-vs-Reactive-Programming/">Bluetooth Development: Callback vs Reactive Programming</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2025-04-02T11:03:38.000Z">2025-04-02</time></p><p class="title is-6"><a class="link-muted" href="/2025/04/02/Bluetooth-security-Implement-authentication/">Securing Bluetooth Communication: Implementing Authentication and Encryption Flows</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-11-03T03:33:53.000Z">2024-11-03</time></p><p class="title is-6"><a class="link-muted" href="/2024/11/03/iOS-18-What-s-news-in-CoreBluetooth/">iOS 18: What&#039;s news in CoreBluetooth?</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-31T03:38:32.000Z">2024-08-31</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/31/Bluetooth-security-Pairing-and-Bonding/">Bluetooth security: Pairing and Bonding</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-04T05:10:39.000Z">2024-08-04</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/04/Android-Bluetooth-A-Pitfall/">Android Bluetooth: A Pitfall</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Appclip/"><span class="tag">Appclip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLE/"><span class="tag">BLE</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bluetooth/"><span class="tag">Bluetooth</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Books/"><span class="tag">Books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cocoa/"><span class="tag">Cocoa</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Concurrency/"><span class="tag">Concurrency</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Conference/"><span class="tag">Conference</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Core-Data/"><span class="tag">Core Data</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CoreBluetooh/"><span class="tag">CoreBluetooh</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CrossPlatform/"><span class="tag">CrossPlatform</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Design-Patterns/"><span class="tag">Design Patterns</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DispatchQueue/"><span class="tag">DispatchQueue</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memory-management/"><span class="tag">Memory management</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Notification/"><span class="tag">Notification</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Objective-C/"><span class="tag">Objective-C</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operations/"><span class="tag">Operations</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ReactNative/"><span class="tag">ReactNative</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reactive/"><span class="tag">Reactive</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RxJava/"><span class="tag">RxJava</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RxSwift/"><span class="tag">RxSwift</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Architecture/"><span class="tag">Software Architecture</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Study/"><span class="tag">Study</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UI/"><span class="tag">UI</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UIStackView/"><span class="tag">UIStackView</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UML/"><span class="tag">UML</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vendor/"><span class="tag">Vendor</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WatchOS/"><span class="tag">WatchOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Bluetooth/"><span class="tag">Web Bluetooth</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/books/"><span class="tag">books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iBeacon/"><span class="tag">iBeacon</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a><p class="size-small"><span>&copy; Uy Nguyen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("vi");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://uynguyen.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>