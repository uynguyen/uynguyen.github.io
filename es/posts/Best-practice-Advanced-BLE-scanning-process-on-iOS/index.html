<!doctype html>
<html lang="es"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Mejores pr√°cticas: Proceso avanzado de escaneo BLE en iOS - Uy Nguyen</title><meta description="Los desarrolladores de iOS est√°n creando aplicaciones que desempe√±an ambos roles, Peripheral y Central, para intercambiar datos con otras copias de aplicaciones. Los datos pueden intercambiarse como"><meta property="og:type" content="blog"><meta property="og:title" content="Mejores pr√°cticas: Proceso avanzado de escaneo BLE en iOS"><meta property="og:url" content=":year/:month/:day/:title/"><meta property="og:site_name" content="Uy Nguyen"><meta property="og:description" content="Los desarrolladores de iOS est√°n creando aplicaciones que desempe√±an ambos roles, Peripheral y Central, para intercambiar datos con otras copias de aplicaciones. Los datos pueden intercambiarse como"><meta property="og:locale" content="es_ES"><meta property="article:published_time" content="2020-08-23T02:51:43.000Z"><meta property="article:modified_time" content="2026-01-26T06:49:48.810Z"><meta property="article:author" content="Uy Nguyen"><meta property="article:tag" content="iOS"><meta property="article:tag" content="BLE"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/Post-Resources/ScanningInBG/cover.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://uynguyen.github.io/es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/index.html"},"headline":"Uy Nguyen","image":["https://uynguyen.github.io/Post-Resources/ScanningInBG/cover.png","https://uynguyen.github.io/Post-Resources/ScanningInBG/ScanningProcedures.png","https://uynguyen.github.io/Post-Resources/ScanningInBG/advertising_method.png","https://uynguyen.github.io/Post-Resources/ScanningInBG/Adv_Packets.png"],"datePublished":"2020-08-23T02:51:43.000Z","dateModified":"2026-01-26T06:49:48.810Z","author":{"@type":"Person","name":"Uy Nguyen"},"description":"Los desarrolladores de iOS est√°n creando aplicaciones que desempe√±an ambos roles, Peripheral y Central, para intercambiar datos con otras copias de aplicaciones. Los datos pueden intercambiarse como"}</script><link rel="canonical" href="https://uynguyen.github.io/es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/index.html"><link rel="icon" href="/Post-Resources/UyNguyen.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><meta property="og:image" content="/Post-Resources/ScanningInBG/cover.png"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-163508356-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-163508356-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><div class="navbar-item has-dropdown is-hoverable language-switcher is-hidden-mobile"><a class="navbar-link" title="Idioma"><i class="fas fa-globe"></i></a><div class="navbar-dropdown is-right"><a class="navbar-item" href="/2020/08/23/Best-practice-Advanced-BLE-scanning-process-on-iOS/">English</a><a class="navbar-item" href="/vi/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/">Ti·∫øng Vi·ªát</a><a class="navbar-item is-active" href="/es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/">Espa√±ol</a></div></div><a class="navbar-item search is-hidden-mobile" title="Buscar" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><div class="mobile-toolbar is-hidden-tablet"><div class="container"><div class="mobile-toolbar-content"><button class="mobile-toolbar-btn" id="mobile-lang-btn" title="Idioma"><i class="fas fa-globe"></i><span>Espa√±ol</span></button><button class="mobile-toolbar-btn search" title="Buscar"><i class="fas fa-search"></i><span>Buscar</span></button></div></div></div><div class="language-picker-overlay" id="lang-picker-overlay"><div class="language-picker-backdrop"></div><div class="language-picker-modal"><div class="language-picker-header"><span>Idioma</span><button class="language-picker-close" id="lang-picker-close"><i class="fas fa-times"></i></button></div><div class="language-picker-options"><a class="language-picker-option" href="/2020/08/23/Best-practice-Advanced-BLE-scanning-process-on-iOS/"><span class="lang-name">English</span></a><a class="language-picker-option" href="/vi/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/"><span class="lang-name">Ti·∫øng Vi·ªát</span></a><a class="language-picker-option is-active" href="/es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/"><span class="lang-name">Espa√±ol</span><i class="fas fa-check"></i></a></div></div></div><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"></div></div><h1 class="title is-3 is-size-4-mobile">Mejores pr√°cticas: Proceso avanzado de escaneo BLE en iOS</h1><div class="content"><p><img src="/Post-Resources/ScanningInBG/cover.png" alt="" title="Banner"></p>
<p>Los desarrolladores de iOS est√°n creando aplicaciones que desempe√±an ambos roles, Peripheral y Central, para intercambiar datos con otras copias de aplicaciones. Los datos pueden intercambiarse como peque√±a informaci√≥n a trav√©s de paquetes BLE o el valor del indicador de intensidad de se√±al (RSSI) de uno a otro. Sin embargo, mantener la aplicaci√≥n para siempre en primer plano es imposible. Tarde o temprano, la aplicaci√≥n entrar√° en modo background por el usuario y finalmente ser√° suspendida por el sistema dependiendo de la RAM disponible, el consumo de energ√≠a y otros factores. Por lo tanto, comprender el procedimiento de advertising y scanning en dispositivos iOS te ayuda a construir buenas aplicaciones que cumplan tus expectativas.<br>Al final de este tutorial, construiremos una aplicaci√≥n simple que act√∫a tanto como scanner como advertiser. Cuando dos aplicaciones se encuentren entre s√≠, escribir√°n un registro de log para an√°lisis. Dependiendo de los resultados, descubriremos qu√© tan efectiva es nuestra aplicaci√≥n usando Core Bluetooth.<br>¬°Vamos a ponernos en marcha!</p>
<a id="more"></a>

<h2 id="Conocimiento-fundamental"><a href="#Conocimiento-fundamental" class="headerlink" title="Conocimiento fundamental"></a>Conocimiento fundamental</h2><p>Seg√∫n el libro <code>Getting Started With Bluetooth Low Energy</code>, los dos prop√≥sitos principales de los paquetes de advertising son:</p>
<ul>
<li>Transmitir datos para aplicaciones.</li>
<li>Descubrir slaves y conectarlos.</li>
</ul>
<p>El tama√±o m√°ximo del payload de cada paquete de advertising es de <strong>31 bytes</strong>, junto con la informaci√≥n del header. Cada intervalo transcurrido, que var√≠a de 20ms a 10.24s, los paquetes de advertising se transmiten ciegamente para notificar su presencia a otros dispositivos o aplicaciones. Hay dos tipos de enfoques de scanning:</p>
<ul>
<li><strong>Passive Scanning</strong>: Los scanners simplemente reciben paquetes de advertising sin ninguna acci√≥n adicional.</li>
<li><strong>Active Scanning</strong>: Despu√©s de recibir un paquete de advertising, el scanner realiza un paquete de Scanning Request al advertiser. Despu√©s de recibir el Scanning Request, el advertiser responde con un paquete de Scanning Response que permite a los advertisers enviar datos extra (31 bytes adicionales) al scanner.</li>
</ul>
<p><img src="/Post-Resources/ScanningInBG/ScanningProcedures.png" alt="" title="Scanning Procedures"></p>
<p>Para clasificar los tipos de paquetes de advertising, nos basamos en tres propiedades: <code>connectability</code>, <code>scannability</code> y <code>directability</code></p>
<table>
<thead>
<tr>
<th align="center">Tipo de paquete Adv</th>
<th align="left">Connectability: Determina si un scanner puede hacer una conexi√≥n o no</th>
<th align="center">Scannability: Determina si un scanner puede emitir un scan request o no</th>
<th align="center">Directability: Determina si este paquete est√° dirigido a alg√∫n scanner en particular o no.</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ADV_IND</td>
<td align="left">S√≠</td>
<td align="center">S√≠</td>
<td align="center">No</td>
</tr>
<tr>
<td align="center">ADV_DIRECT_IND</td>
<td align="left">S√≠</td>
<td align="center">No</td>
<td align="center">S√≠</td>
</tr>
<tr>
<td align="center">ADV_NONCONN_IND</td>
<td align="left">No</td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
<tr>
<td align="center">ADV_SCAN_IND</td>
<td align="left">No</td>
<td align="center">S√≠</td>
<td align="center">No</td>
</tr>
</tbody></table>
<p>Hay muchos m√°s temas avanzados que se describen con m√°s detalle en el libro <code>Getting Started With Bluetooth Low Energy</code>, como c√≥mo se organizan los datos en dispositivos BLE y c√≥mo comunicarse con hardware existente, etc. Si quieres saber m√°s, consulta el libro.<br>Debido al alcance de esta publicaci√≥n, entender el proceso de advertising es suficiente para que pasemos a la siguiente secci√≥n.</p>
<h2 id="Scanning-y-advertising-en-iOS"><a href="#Scanning-y-advertising-en-iOS" class="headerlink" title="Scanning y advertising en iOS"></a>Scanning y advertising en iOS</h2><h3 id="Configurando-el-advertiser-Peripheral"><a href="#Configurando-el-advertiser-Peripheral" class="headerlink" title="Configurando el advertiser - Peripheral"></a>Configurando el advertiser - Peripheral</h3><p>Vamos a reutilizar mi repositorio anterior que permite que un tel√©fono iOS haga advertising como peripheral usando Core Bluetooth.<br>Primero, generar√© 5 UUIDs como los services del advertiser (Peripheral).</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> kServiceUUID1 = <span class="string">"1FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">let</span> kServiceUUID4 = <span class="string">"4FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span></span><br><span class="line"><span class="keyword">let</span> kServiceUUID5 = <span class="string">"5FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span></span><br></pre></td></tr></table></figure>

<p>A continuaci√≥n, crear√© una lista de <code>CBMutableService</code> y luego los agregar√© al objeto <code>CBPeripheralManager</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">services.forEach &#123; (each) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> cbService = <span class="type">CBMutableService</span>(type: each.uuid.cbUUID, primary: <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">var</span> charArr = [<span class="type">CBMutableCharacteristic</span>]()</span><br><span class="line"></span><br><span class="line">    each.characteristics.forEach &#123; (char) <span class="keyword">in</span></span><br><span class="line">        charArr.append(<span class="type">CBMutableCharacteristic</span>.<span class="keyword">init</span>(</span><br><span class="line">            type: char.uuid.cbUUID,</span><br><span class="line">        properties: [.read, .write, .notify],</span><br><span class="line">        value: <span class="literal">nil</span>,</span><br><span class="line">        permissions: <span class="type">CBAttributePermissions</span>(char.permissions.<span class="built_in">map</span> &#123; $<span class="number">0</span>.cbAttributePermission &#125; )))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cbService.characteristics = charArr</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.peripheralManager.add(cbService)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finalmente, comenzamos el advertising del peripheral cuando su estado est√° listo.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.peripheralManager.startAdvertising([<span class="type">CBAdvertisementDataLocalNameKey</span>: <span class="string">"uynguyen"</span>,</span><br><span class="line">                                        <span class="type">CBAdvertisementDataServiceUUIDsKey</span>: <span class="keyword">self</span>.cbServices.<span class="built_in">map</span> &#123; $<span class="number">0</span>.uuid &#125;])</span><br></pre></td></tr></table></figure>

<p>Cuando se ejecuta el c√≥digo anterior, veremos que se imprimen los siguientes logs.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Add service 1FA2FD8A-17E0-4D3B-AF45-305DA6130E39 Succeeded</span><br><span class="line">---&gt; Chars [&lt;CBMutableCharacteristic: 0x2802d4070 UUID = 463FED20-DA93-45E7-B00F-B5CD99775150, Value = (null), Properties = 0x1A, Permissions = 0x3, Descriptors = (null), SubscribedCentrals = (</span><br><span class="line">)&gt;, &lt;CBMutableCharacteristic: 0x2802d4380 UUID = 463FED21-DA93-45E7-B00F-B5CD99775150, Value = (null), Properties = 0x112, Permissions = 0x1, Descriptors = (null), SubscribedCentrals = (</span><br><span class="line">)&gt;, &lt;CBMutableCharacteristic: 0x2802d4620 UUID = 463FED22-DA93-45E7-B00F-B5CD99775150, Value = &#123;length = 6, bytes = 0x486168616861&#125;, Properties = 0x2, Permissions = 0x1, Descriptors = (null), SubscribedCentrals = (</span><br><span class="line">)&gt;]</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Add service 5FA2FD8A-17E0-4D3B-AF45-305DA6130E39 Succeeded</span><br><span class="line">---&gt; Chars []</span><br><span class="line"></span><br><span class="line">===&gt; Start advertising Succeeded</span><br></pre></td></tr></table></figure>

<h3 id="Configurando-el-scanner-Central"><a href="#Configurando-el-scanner-Central" class="headerlink" title="Configurando el scanner - Central"></a>Configurando el scanner - Central</h3><p>El siguiente paso es configurar nuestro Central Manager - el scanner. Como podr√≠as saber de mi tutorial anterior, el c√≥digo para escanear dispositivos cercanos es bastante simple.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startScanning</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.centralManager?.scanForPeripherals(withServices: <span class="literal">nil</span>,</span><br><span class="line">                                            options: [<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>: <span class="literal">true</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>El valor <code>nil</code> que pasamos al par√°metro <code>withServices</code> indica que escanearemos todos los dispositivos cercanos sin especificar service uuids.</li>
<li>La opci√≥n <code>CBCentralManagerScanOptionAllowDuplicatesKey</code> especifica que el escaneo debe ejecutarse sin filtrado de duplicados.</li>
</ul>
<p>Una vez que el central descubre un peripheral, imprimiremos su informaci√≥n incluyendo el local name y el valor de <code>CBAdvertisementDataServiceUUIDsKey</code> en el paquete de advertising.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager, didDiscover peripheral: CBPeripheral, advertisementData: [String : <span class="keyword">Any</span>], rssi RSSI: NSNumber)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Did found per \(peripheral.name)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"CBAdvertisementDataServiceUUIDsKey adv value "</span> + advertisementData[<span class="type">CBAdvertisementDataServiceUUIDsKey</span>])</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vamos a compilar y ejecutar el proyecto,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Did found peripheral name: Optional(<span class="string">"Uy Nguyen iPad"</span>)</span><br><span class="line">CBAdvertisementDataServiceUUIDsKey adv value:</span><br><span class="line">Optional(&lt;__NSArrayM 0x282a79350&gt;(</span><br><span class="line">    1FA2FD8A-17E0-4D3B-AF45-305DA6130E39</span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<p>Mirando el log, ¬øpuedes detectar qu√© est√° mal? Hay un problema con el paquete de advertising: el valor de <code>CBAdvertisementDataServiceUUIDsKey</code> contiene solo 1 service, ¬ød√≥nde est√°n los otros services del 2 al 5?</p>
<p>Imprimamos el paquete de advertising completo para ver qu√© contiene.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"kCBAdvDataServiceUUIDs"</span>: &lt;__NSArrayM 0x283460630&gt;(</span><br><span class="line">1FA2FD8A-17E0-4D3B-AF45-305DA6130E39</span><br><span class="line">)</span><br><span class="line">, <span class="string">"kCBAdvDataLocalName"</span>: uynguyen, <span class="string">"kCBAdvDataTimestamp"</span>: 620013184.4512661, <span class="string">"kCBAdvDataRxPrimaryPHY"</span>: 0, <span class="string">"kCBAdvDataIsConnectable"</span>: 1, <span class="string">"kCBAdvDataRxSecondaryPHY"</span>: 0]</span><br></pre></td></tr></table></figure>

<p>Sin suerte, no podemos encontrar los otros services desde <code>&quot;2FA2FD8A-17E0-4D3B-AF45-305DA6130E39&quot;</code> hasta <code>&quot;5FA2FD8A-17E0-4D3B-AF45-305DA6130E39&quot;</code>.</p>
<h3 id="Encontrando-problemas"><a href="#Encontrando-problemas" class="headerlink" title="Encontrando problemas"></a>Encontrando problemas</h3><p>Resulta que el paquete de advertising que el Central recibe depende de c√≥mo llamamos al m√©todo <code>scanForPeripherals</code>.<br>Si cambiamos el par√°metro <code>withServices</code> a un array de nuestros services desde <code>&quot;1FA2FD8A-17E0-4D3B-AF45-305DA6130E39&quot;</code> hasta <code>&quot;5FA2FD8A-17E0-4D3B-AF45-305DA6130E39&quot;</code> expl√≠citamente, veremos las diferencias.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startScanning</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.centralManager?.scanForPeripherals(withServices: [<span class="type">CBUUID</span>(string: <span class="string">"1FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span>),</span><br><span class="line">                                                            <span class="type">CBUUID</span>(string: <span class="string">"2FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span>),</span><br><span class="line">                                                            <span class="type">CBUUID</span>(string: <span class="string">"3FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span>),</span><br><span class="line">                                                            <span class="type">CBUUID</span>(string: <span class="string">"4FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span>),</span><br><span class="line">                                                            <span class="type">CBUUID</span>(string: <span class="string">"5FA2FD8A-17E0-4D3B-AF45-305DA6130E39"</span>)],</span><br><span class="line">                                                            options: [<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>: <span class="literal">true</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Aqu√≠ est√° el log que resulta.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"kCBAdvDataIsConnectable"</span>: 1, <span class="string">"kCBAdvDataServiceUUIDs"</span>: &lt;__NSArrayM 0x280708750&gt;(</span><br><span class="line">1FA2FD8A-17E0-4D3B-AF45-305DA6130E39</span><br><span class="line">)</span><br><span class="line">, <span class="string">"kCBAdvDataLocalName"</span>: uynguyen, <span class="string">"kCBAdvDataRxSecondaryPHY"</span>: 0, <span class="string">"kCBAdvDataHashedServiceUUIDs"</span>: &lt;__NSArrayM 0x280708720&gt;(</span><br><span class="line">2FA2FD8A-17E0-4D3B-AF45-305DA6130E39,</span><br><span class="line">3FA2FD8A-17E0-4D3B-AF45-305DA6130E39,</span><br><span class="line">4FA2FD8A-17E0-4D3B-AF45-305DA6130E39,</span><br><span class="line">5FA2FD8A-17E0-4D3B-AF45-305DA6130E39</span><br><span class="line">)</span><br><span class="line">, <span class="string">"kCBAdvDataRxPrimaryPHY"</span>: 0, <span class="string">"kCBAdvDataTimestamp"</span>: 620013608.239601]</span><br></pre></td></tr></table></figure>

<p>Ahora, podemos ver el nuevo valor contenido dentro del paquete de advertising, el <code>kCBAdvDataHashedServiceUUIDs</code>. Pero ¬øqu√© es?<br>Volvamos al lado del Peripheral, si miras m√°s de cerca la definici√≥n del m√©todo de advertising del objeto Peripheral, podr√≠as saber qu√© es realmente.</p>
<p><img src="/Post-Resources/ScanningInBG/advertising_method.png" alt="" title="Advetising definition"></p>
<p>En resumen, cuando haces que un iPhone haga advertising como peripheral, si no hay espacio para ning√∫n service UUID contenido en el valor de <code>CBAdvertisementDataServiceUUIDsKey</code>, estos services se mover√°n a otro espacio llamado <code>overflow area</code>.</p>
<p>Otro t√©rmino, T_T ¬øQu√© significa exactamente el <code>overflow area</code>?<br>B√°sicamente, el <code>overflow area</code> se coloca en el paquete de scan response. Estos service uuids son hasheados por el algoritmo de Apple y son descubiertos solo por un dispositivo iOS que escanea expl√≠citamente por ellos. En nuestro caso, porque pasamos nuestros service uuids del 1F al 5F cuando comenzamos a escanear, obtendremos este valor <code>kCBAdvDataHashedServiceUUIDs</code> en los paquetes de advertising.</p>
<p>Para verificar esta declaraci√≥n, uso una herramienta introducida por Apple para depuraci√≥n BLE - (<a href="https://www.bluetooth.com/blog/a-new-way-to-debug-iosbluetooth-applications/">A New Way to Debug iOS Bluetooth Applications</a>), para capturar el paquete de advertising de nuestro Peripheral para an√°lisis.<br>Y aqu√≠ est√° el resultado</p>
<p><img src="/Post-Resources/ScanningInBG/Adv_Packets.png" alt="" title="Advetising packets"></p>
<ul>
<li>Tipo de paquete de Advertising: <code>ADV_IND</code>, lo que significa que el scanner puede hacer una conexi√≥n con √©l; y un scanner puede emitir un scan request; y sus paquetes no est√°n dirigidos a ning√∫n scanner en particular.</li>
<li>El cuadro amarillo son los datos de advertising: (Data: 02 01 1A 11 06 39 0E 13 A6 5D 30 45 AF 3B 4D E0 17 8A FD A2 1F 09 09 75 79 6E 67 75 79 65 6E), longitud = 31 bytes; contiene <code>CBAdvertisementDataLocalName</code> (75 79 6E 67 75 79 65 6E &gt; ‚Äúuynguyen‚Äù) y nuestro primer service uuid 1F A2 FD 8A 17 E0 4D 3B AF 45 30 5D A6 13 0E 39 (39 0E 13 A6 5D 30 45 AF 3B 4D E0 17 8A FD A2 1F).</li>
<li>El paquete de scan response (SCAN_RSP) contiene la otra informaci√≥n que el paquete de advertising no tiene suficiente longitud para transportar. En nuestro caso, contiene los otros services del 2F al 5F. Entender este paquete es bastante complejo para ponerlo en este tutorial, as√≠ que omitir√© explicarlo por ahora. Tengo otro tutorial trabajando en este paquete m√°s adelante.</li>
</ul>
<p>En conclusi√≥n, lo que hemos encontrado aqu√≠ es: El Advertising, mientras la aplicaci√≥n est√° en background, funciona de manera diferente que cuando est√° en foreground.</p>
<ul>
<li><code>CBAdvertisementDataLocalNameKey</code> es ignorado.</li>
<li>Todos los service UUIDs contenidos en el valor de la clave de advertisement CBAdvertisementDataServiceUUIDsKey se colocan en un √°rea especial de ‚Äúoverflow‚Äù; solo pueden ser descubiertos por un dispositivo iOS que escanee expl√≠citamente por ellos.</li>
</ul>
<h2 id="Pruebas"><a href="#Pruebas" class="headerlink" title="Pruebas"></a>Pruebas</h2><p>La tabla a continuaci√≥n resume lo que hemos investigado.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* S√ç significa que el Central puede encontrar al Peripheral.</span><br></pre></td></tr></table></figure>

<h4 id="Caso-1-Las-pantallas-de-ambos-Peripheral-y-Central-estan-encendidas"><a href="#Caso-1-Las-pantallas-de-ambos-Peripheral-y-Central-estan-encendidas" class="headerlink" title="Caso 1 - Las pantallas de ambos Peripheral y Central est√°n encendidas"></a>Caso 1 - Las pantallas de ambos Peripheral y Central est√°n encendidas</h4><table>
<thead>
<tr>
<th align="center">\</th>
<th align="center">Peripheral Background</th>
<th align="center">Peripheral Foreground</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Central Background</strong></td>
<td align="center">S√≠</td>
<td align="center">S√≠</td>
</tr>
<tr>
<td align="center"><strong>Central Foreground</strong></td>
<td align="center">S√≠</td>
<td align="center">S√≠</td>
</tr>
</tbody></table>
<h4 id="Caso-2-Pantalla-del-Peripheral-apagada-bloqueada-pantalla-del-Central-encendida"><a href="#Caso-2-Pantalla-del-Peripheral-apagada-bloqueada-pantalla-del-Central-encendida" class="headerlink" title="Caso 2 - Pantalla del Peripheral apagada (bloqueada), pantalla del Central encendida"></a>Caso 2 - Pantalla del Peripheral apagada (bloqueada), pantalla del Central encendida</h4><table>
<thead>
<tr>
<th align="center">\</th>
<th align="center">Peripheral Background</th>
<th align="center">Peripheral Foreground</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Central Background</strong></td>
<td align="center">S√≠</td>
<td align="center">S√≠</td>
</tr>
<tr>
<td align="center"><strong>Central Foreground</strong></td>
<td align="center">S√≠</td>
<td align="center">S√≠</td>
</tr>
</tbody></table>
<h4 id="Caso-3-Pantalla-del-Central-apagada-bloqueada-pantalla-del-Peripheral-encendida"><a href="#Caso-3-Pantalla-del-Central-apagada-bloqueada-pantalla-del-Peripheral-encendida" class="headerlink" title="Caso 3 - Pantalla del Central apagada (bloqueada), pantalla del Peripheral encendida"></a>Caso 3 - Pantalla del Central apagada (bloqueada), pantalla del Peripheral encendida</h4><table>
<thead>
<tr>
<th align="center">\</th>
<th align="center">Peripheral Background</th>
<th align="center">Peripheral Foreground</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Central Background</strong></td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
<tr>
<td align="center"><strong>Central Foreground</strong></td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
</tbody></table>
<h4 id="Caso-4-Las-pantallas-de-ambos-Peripheral-y-Central-estan-apagadas-bloqueadas"><a href="#Caso-4-Las-pantallas-de-ambos-Peripheral-y-Central-estan-apagadas-bloqueadas" class="headerlink" title="Caso 4 - Las pantallas de ambos Peripheral y Central est√°n apagadas (bloqueadas)"></a>Caso 4 - Las pantallas de ambos Peripheral y Central est√°n apagadas (bloqueadas)</h4><table>
<thead>
<tr>
<th align="center">\</th>
<th align="center">Peripheral Background</th>
<th align="center">Peripheral Foreground</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Central Background</strong></td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
<tr>
<td align="center"><strong>Central Foreground</strong></td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
</tbody></table>
<p>De los experimentos anteriores, independientemente del estado del dispositivo que juega el rol de Peripheral, la pantalla del dispositivo que juega el modo Central debe estar encendida para que pueda escanear peripherals cercanos. En otras palabras, si estamos construyendo una aplicaci√≥n que permite que un dispositivo iOS descubra otros dispositivos iOS cercanos, <code>tenemos que ejecutar ambos modos Central y Peripheral en cada dispositivo Y lo m√°s importante, si dos dispositivos quieren encontrarse, cualquiera de las pantallas debe estar encendida.</code><br>Hay una t√©cnica (Es m√°s bien un truco) para superar este problema, que es programar peri√≥dicamente el env√≠o de notificaciones push a tus dispositivos iOS, lo cual inmediatamente enciende la pantalla para que el Central pueda descubrir Peripherals cercanos.<br>Mientras la aplicaci√≥n est√° en background, funciona de manera diferente que cuando est√° en foreground. Una de ellas es que la frecuencia de los paquetes de advertising que se env√≠an puede disminuir. Como resultado, un Scanner en background encuentra peripherals cercanos m√°s lento comparado con cuando est√° en foreground.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusi√≥n"></a>Conclusi√≥n</h2><p>¬°Felicitaciones! Recorrimos un tutorial para obtener una visi√≥n m√°s profunda de c√≥mo funciona CoreBluetooth en iOS tanto en modos Central como Peripheral. ¬°Espero que encuentres interesante esta publicaci√≥n!<br>Si tienes alg√∫n comentario, si√©ntete libre de enviarme un correo electr√≥nico a <a href="mailto:uynguyen.itus@gmail.com">uynguyen.itus@gmail.com</a> o deja tus preguntas en el cuadro de comentarios.</p>
<p><code>Hecho con amor.</code></p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/"></a><a class="link-muted mr-2" rel="tag" href="/"></a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5e9474199d6bcc0012d5bba6&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://ko-fi.com/uynguyen" style="background-color:rgba(255,128,62,.87);border-color:transparent;color:white;" target="_blank" rel="noopener"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button is-warning donate" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="uynguyen.itus@gmail.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5">Comentarios</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://uynguyen.github.io/es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/index.html';
            this.page.identifier = 'es/posts/Best-practice-Advanced-BLE-scanning-process-on-iOS/index.html';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'uynguyen-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen"></figure><p class="title is-size-4 is-block line-height-inherit">Uy Nguyen</p><p class="is-size-6 is-block">Software engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-envelope mr-1"></i><span>uynguyen.itus@gmail.com</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Entradas</p><a href="/archives"><p class="title">58</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categor√≠as</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Etiquetas</p><a href="/tags"><p class="title">33</p></a></div></div></nav><div class="level"><a class="level-item button is-rounded" style="background-color:#f14668e3;color:white;font-weight:bold;" href="https://ko-fi.com/uynguyen" target="_blank" rel="noopener">if üëç then Buy me a Coffee</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/uynguyen"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://www.linkedin.com/in/uynguyen505"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Enlaces</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://uynguyen.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Uy Nguyen</span></span><span class="level-right"><span class="level-item tag">uynguyen.github.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recientes</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2025-04-02T11:03:38.000Z">2025-04-02</time></p><p class="title is-6"><a class="link-muted" href="/2025/04/02/Bluetooth-security-Implement-authentication/">Securing Bluetooth Communication: Implementing Authentication and Encryption Flows</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-11-03T03:33:53.000Z">2024-11-03</time></p><p class="title is-6"><a class="link-muted" href="/2024/11/03/iOS-18-What-s-news-in-CoreBluetooth/">iOS 18: What&#039;s news in CoreBluetooth?</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-31T03:38:32.000Z">2024-08-31</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/31/Bluetooth-security-Pairing-and-Bonding/">Bluetooth security: Pairing and Bonding</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-04T05:10:39.000Z">2024-08-04</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/04/Android-Bluetooth-A-Pitfall/">Android Bluetooth: A Pitfall</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-06-30T03:48:09.000Z">2024-06-30</time></p><p class="title is-6"><a class="link-muted" href="/2024/06/30/Best-practice-iOS-vs-Android-Bluetooth/">Best practice: iOS vs Android Bluetooth</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Etiquetas</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Appclip/"><span class="tag">Appclip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLE/"><span class="tag">BLE</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bluetooth/"><span class="tag">Bluetooth</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Books/"><span class="tag">Books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cocoa/"><span class="tag">Cocoa</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Concurrency/"><span class="tag">Concurrency</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Conference/"><span class="tag">Conference</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Core-Data/"><span class="tag">Core Data</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CoreBluetooh/"><span class="tag">CoreBluetooh</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CrossPlatform/"><span class="tag">CrossPlatform</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Design-Patterns/"><span class="tag">Design Patterns</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DispatchQueue/"><span class="tag">DispatchQueue</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memory-management/"><span class="tag">Memory management</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Notification/"><span class="tag">Notification</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Objective-C/"><span class="tag">Objective-C</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operations/"><span class="tag">Operations</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ReactNative/"><span class="tag">ReactNative</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Architecture/"><span class="tag">Software Architecture</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Study/"><span class="tag">Study</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UI/"><span class="tag">UI</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UIStackView/"><span class="tag">UIStackView</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UML/"><span class="tag">UML</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vendor/"><span class="tag">Vendor</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WatchOS/"><span class="tag">WatchOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Bluetooth/"><span class="tag">Web Bluetooth</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/books/"><span class="tag">books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iBeacon/"><span class="tag">iBeacon</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a><p class="size-small"><span>&copy; Uy Nguyen</span>¬†¬†Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>¬†&amp;¬†<a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("es");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://uynguyen.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Teclea algo..."></div><a class="searchbox-close" href="javascript:;">√ó</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Teclea algo...","untitled":"(Untitled)","posts":"Entradas","pages":"Pages","categories":"Categor√≠as","tags":"Etiquetas"});
        });</script></body></html>