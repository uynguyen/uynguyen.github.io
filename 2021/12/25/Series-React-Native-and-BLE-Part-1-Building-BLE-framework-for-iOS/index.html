<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Series React Native and BLE: Part 1 - Building BLE framework for iOS - Uy Nguyen</title><meta description="I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the commu"><meta property="og:type" content="blog"><meta property="og:title" content="Series React Native and BLE: Part 1 - Building BLE framework for iOS"><meta property="og:url" content=":year/:month/:day/:title/"><meta property="og:site_name" content="Uy Nguyen"><meta property="og:description" content="I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the commu"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-12-25T11:16:08.000Z"><meta property="article:modified_time" content="2024-03-23T03:54:36.082Z"><meta property="article:author" content="Uy Nguyen"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/Post-Resources/RN-BLE/cover1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://uynguyen.github.io/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/"},"headline":"Uy Nguyen","image":["https://uynguyen.github.io/Post-Resources/RN-BLE/cover1.png","https://uynguyen.github.io/Post-Resources/RN-BLE/ios_create_project.png","https://uynguyen.github.io/Post-Resources/RN-BLE/ios_build_distribution.png","https://uynguyen.github.io/Post-Resources/RN-BLE/ios_build_result.png","https://uynguyen.github.io/Post-Resources/RN-BLE/bridging-header.png","https://uynguyen.github.io/Post-Resources/RN-BLE/Scan-Result.png"],"datePublished":"2021-12-25T11:16:08.000Z","dateModified":"2024-03-23T03:54:36.082Z","author":{"@type":"Person","name":"Uy Nguyen"},"description":"I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the commu"}</script><link rel="canonical" href="https://uynguyen.github.io/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/"><link rel="icon" href="/Post-Resources/UyNguyen.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><meta property="og:image" content="/Post-Resources/RN-BLE/cover1.png"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-163508356-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-163508356-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"></div></div><h1 class="title is-3 is-size-4-mobile">Series React Native and BLE: Part 1 - Building BLE framework for iOS</h1><div class="content"><p><img src="/Post-Resources/RN-BLE/cover1.png" alt=""></p>
<p>I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the communication of RN/Flutter to BLE. Thus, I decided to introduce this series React Native and BLE to guide you on how to develop a native BLE framework and connect it to React Native.<br>Of course, there will be another series for Flutter and BLE after finishing the series of React Native.<br>In this series, I will guide you through a completed process from development to distribution.</p>
<a id="more"></a>

<ul>
<li>Create an iOS / Android framework.</li>
<li>Script to build and distribute your framework.</li>
<li>Import the frameworks to your React Native project.</li>
<li>Use your native framework in React Native.</li>
<li>Distribute your app.</li>
<li>And other cool stuff I want to share with you …</li>
</ul>
<p>If you love what I do, consider supporting me at <a href="https://ko-fi.com/uynguyen">buy a coffee for Uy Nguyen</a> :)<br>Let’s go.</p>
<blockquote>
<p>Xcode 13, iOS 15, Swift 5, React 17.0.1, React Native 0.64.1.</p>
</blockquote>
<h3 id="Prepare-iOS-framework"><a href="#Prepare-iOS-framework" class="headerlink" title="Prepare iOS framework"></a>Prepare iOS framework</h3><p>The first step is creating a BLE framework. You also don’t have to create a framework, you can include your source code inside the iOS project directly if you want to.<br>However, the reason why I recommend moving all BLE logic to a framework is that it’s reusable, you can share your framework to other projects such as Flutter or Native projects without having to duplicate the logic.<br>Another reason is that it will improve the compile time of Xcode, breaking your app into several frameworks can speed up the build times. This is because the Xcode build system doesn’t have to recompile frameworks for which Swift files have not changed.</p>
<p>From the top left bar of Xcode, select <code>File &gt; New &gt; Project &gt; From the &quot;Framework &amp; Library&quot; section, select &quot;Framework&quot; &gt; Enter your framework name (I use &quot;BLEFramework&quot;)</code></p>
<p><img src="/Post-Resources/RN-BLE/ios_create_project.png" alt=""></p>
<p>Now, you can develop your BLE logic in the project you just created. I’m not going to detail implementing all single methods of the framework as it depends on your business logic and your architecture. You can find my previous tutorials to have an idea of how to implement a BLE framework. <a href="/2017/10/13/Bluetooth-Low-Energy-On-iOS/">Bluetooth Low Energy OniOS</a>, <a href="/2018/02/21/Play-Central-And-Peripheral-Roles-With-CoreBluetooth/">Play Central And Peripheral Roles With CoreBluetooth</a><br>I will take a simple method in my BLE framework as an example: the <code>startScanning</code> method.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Class: CentralManager</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @discussion Start scanning nearby peripherals and returns to the `ScanningDelegate`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startScanningFor</span><span class="params">(delegate: ScanningDelegate, <span class="built_in">filter</span>: DeviceFilter = DeviceFilter<span class="params">()</span></span></span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">//... BLE implementation.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK now we have a BLE framework, let move to the next step: Building and distributing your framework.</p>
<h3 id="Building-and-distributing"><a href="#Building-and-distributing" class="headerlink" title="Building and distributing"></a>Building and distributing</h3><p>There are many ways to distribute a framework like using <a href="/2017/09/25/Create-and-Distribute-Private-Libraries-with-Cocoapods">CocoaPod</a>, or manually by sending a complied file, etc. In this post, I will provide you with a script to turn your framework into a universal framework that hides all your logic, and can be used for both physical devices and simulators.</p>
<p>Make sure you turn “Build Libraries for Distribution” flag in the “Build Settings” to <code>YES</code>. The flag indicates that the compiler should generate one of the stable interfaces so the framework can be used when newer versions of Xcode or the Swift compiler are released.</p>
<p><img src="/Post-Resources/RN-BLE/ios_build_distribution.png" alt=""></p>
<p>Next, create a bash file, put it in the root of the ios folder, and copy the following commands to the file. Then execute the script.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### SCRIPT TO BUILD A SWIFT UNIVERSAL FRAMEWORK</span></span><br><span class="line"></span><br><span class="line">PRODUCT_NAME=<span class="string">"REPLACE_BY_YOUR_TARGET_NAME"</span></span><br><span class="line">BUILD_CONFIGURATION=<span class="string">"Release"</span></span><br><span class="line">DERIVED_DATA_PATH=<span class="string">"<span class="variable">$(pwd)</span>/build"</span></span><br><span class="line">RELEASE_DIR=<span class="string">"<span class="variable">$(pwd)</span>/RELEASE"</span></span><br><span class="line">BUILD_SCHEME=<span class="string">"<span class="variable">$&#123;PRODUCT_NAME&#125;</span>"</span></span><br><span class="line">FRAMEWORK_NAME=<span class="string">"<span class="variable">$&#123;PRODUCT_NAME&#125;</span>.framework"</span></span><br><span class="line"></span><br><span class="line">RELEASE_DEVICE_PATH=<span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/device/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">RELEASE_SIMULATOR_PATH=<span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/simulator/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">rm -rf <span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span></span><br><span class="line">rm -rf <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/simulator"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/device"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build library for simulator</span></span><br><span class="line">fastlane ios build  scheme:<span class="string">"<span class="variable">$&#123;BUILD_SCHEME&#125;</span>"</span> \</span><br><span class="line">					configuration:<span class="string">"<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>"</span> \</span><br><span class="line">					sdk:iphonesimulator \</span><br><span class="line">					build_dir:<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span> \</span><br><span class="line">					--verbose</span><br><span class="line"></span><br><span class="line">SIMULATOR_FRAMEWORK_PATH=<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>/Build/Products/<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>-iphonesimulator/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$&#123;SIMULATOR_FRAMEWORK_PATH&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;RELEASE_SIMULATOR_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build library for iphoneos</span></span><br><span class="line">fastlane ios build  scheme:<span class="string">"<span class="variable">$&#123;BUILD_SCHEME&#125;</span>"</span> \</span><br><span class="line">					configuration:<span class="string">"<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>"</span> \</span><br><span class="line">					sdk:iphoneos \</span><br><span class="line">					build_dir:<span class="string">"<span class="variable">$DERIVED_DATA_PATH</span>"</span> \</span><br><span class="line">					--verbose</span><br><span class="line"></span><br><span class="line">DEVICE_FRAMEWORK_PATH=<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>/Build/Products/<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>-iphoneos/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$&#123;DEVICE_FRAMEWORK_PATH&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;RELEASE_DEVICE_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Merge SDKs</span></span><br><span class="line">xcodebuild -create-xcframework -output <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/<span class="variable">$&#123;PRODUCT_NAME&#125;</span>.xcframework"</span> \</span><br><span class="line">  -framework <span class="string">"<span class="variable">$&#123;RELEASE_DEVICE_PATH&#125;</span>"</span> \</span><br><span class="line">  -framework <span class="string">"<span class="variable">$&#123;RELEASE_SIMULATOR_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">open <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p>Once you run the script successfully, you should see the result as below</p>
<p><img src="/Post-Resources/RN-BLE/ios_build_result.png" alt=""></p>
<p>In which:</p>
<ul>
<li><code>YOUR_TARGET_NAME.xcframework</code>: The universal framework can be used for both physical devices and simulators.</li>
<li>device folder: contains <code>YOUR_TARGET_NAME.framework</code> which can be used only on physical devices.</li>
<li>simulator folder: contains <code>YOUR_TARGET_NAME.framework</code> which can be used only on simulators.</li>
</ul>
<p>Now we have a BLE framework for our application, let’s move to the next step - Create a new React Native project.</p>
<h3 id="Init-React-Native-project"><a href="#Init-React-Native-project" class="headerlink" title="Init React Native project"></a>Init React Native project</h3><p>To create a React Native project without using Expo (I recommend to not using Expo because we’re going to add a lot of Native code for Android and iOS to our project, for more details you can refer to <a href="https://stackoverflow.com/questions/39170622/what-is-the-difference-between-expo-and-react-native">what is the difference between expo and react native</a>), open terminal and type</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init projectName</span><br></pre></td></tr></table></figure>

<p>Wait a while to set up your project. After running successfully, you should see the folder structure as below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|---projectName</span><br><span class="line">    |---ios</span><br><span class="line">        |---projectName.xcworkspace</span><br><span class="line">    |---android</span><br><span class="line">    |---...Other files, folders</span><br></pre></td></tr></table></figure>

<p>Open the <code>projectName.xcworkspace</code> file, we will config the native code in the next step.</p>
<h3 id="Wire-them-together"><a href="#Wire-them-together" class="headerlink" title="Wire them together"></a>Wire them together</h3><p>First, drag and drop the <code>YOUR_TARGET_NAME.xcframework</code> to your Xcode workspace.<br>As my SDK is built in Swift, I’m going to create a Swift class as a bridge so that we can communicate from the SDK to React Native.<br>From Xcode project, select <code>File &gt; New &gt; File &gt; Swift File &gt; Enter your file name (e.g BLEManager) &gt; Add</code>. A dialog will pop up to ask if you want to create a bridging header, select yes.</p>
<blockquote>
<p>For those who don’t know what the bridging header is used for, the bridging header is where you define all the Objective-C classes that are exposed to Swift.</p>
</blockquote>
<p><img src="/Post-Resources/RN-BLE/bridging-header.png" alt=""></p>
<p>To use RCT classes, make sure you <code>#import</code> all related headers to your <code>...-Bridging-Header.h</code>. Otherwise, you will get complied errors.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;React/RCTBridgeModule.h&gt;</span><br><span class="line">#<span class="keyword">import</span> "React/RCTEventEmitter.h"</span><br><span class="line">#<span class="keyword">import</span> "React/RCTViewManager.h"</span><br><span class="line">#<span class="keyword">import</span> &lt;React/RCTLog.h&gt;</span><br></pre></td></tr></table></figure>

<p>Next, add the interface <code>RCTEventEmitter</code> to the class <code>BLEManager</code> we just created in the previous step.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span>(<span class="type">BLEManager</span>) &lt;--- <span class="type">Remember</span> to add this [<span class="number">1</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BLEManager</span>: <span class="title">RCTEventEmitter</span>, <span class="title">ScanningDelegate</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> didFoundDeviceEvent = <span class="string">"didFoundDevice"</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@objc</span> &lt;--- <span class="type">Remember</span> to add this</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">BLEManager</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    <span class="number">_</span> = <span class="type">BLEWrapper</span>.shared</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@objc</span>(startScanning) &lt;--- <span class="type">Remember</span> to add this</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startScanning</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">BLEWrapper</span>.shared.startScanning(<span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">managerDidFoundDevice</span><span class="params">(<span class="number">_</span> manager: CentralManager, device: Device, rssi: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.sendEvent(withName: <span class="type">Self</span>.didFoundDeviceEvent, body: [<span class="string">"name"</span>: device.localName, <span class="string">"rssi"</span>: rssi]) [<span class="number">2</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requiresMainQueueSetup</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedEvents</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>]! &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="type">Self</span>.didFoundDeviceEvent] [<span class="number">3</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[1] Make sure you decorate your class and functions by the <code>@objc</code> keyword to ensure the class and functions are exported properly to the Objective-C runtime.<br>[2] Once a peripheral is discovered, send an event to Javascript.<br>[3] Register supported the event from the native module.</p>
<p>Finally, to expose the methods of your native module, create a new file <code>BLEManager.m</code> and add the following code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface <span class="type">RCT_EXTERN_MODULE</span>(<span class="type">BLEManager</span>, <span class="type">RCTViewManager</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">RCT_EXTERN_METHOD</span>(startScanning)</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>That’s all. Javacsript now can invoke the <code>startScanning</code> function and listen to the <code>didFoundDeviceEvent</code> event.</p>
<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><p>It’s time to test our implementation, React Native provides <code>NativeEventEmitter</code> and <code>NativeModules</code> instances that allow you to work with native modules.<br>from the root folder, open <code>App.js</code> and import the necessary things. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="type">NativeEventEmitter</span>,</span><br><span class="line">  <span class="type">NativeModules</span>,</span><br><span class="line">&#125; from 'react-native';</span><br><span class="line">const &#123;<span class="type">BLEManager</span>&#125; = <span class="type">NativeModules</span>; &lt;-- <span class="type">You</span> can then access the <span class="type">BLEManager</span> native module</span><br></pre></td></tr></table></figure>

<p>In <code>componentDidMount</code> method, add the following to it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">let</span> beaconManagerEmitter = new <span class="type">NativeEventEmitter</span>(<span class="type">BLEManager</span>); [<span class="number">1</span>]</span><br><span class="line">    this.didFoundDevice = beaconManagerEmitter.addListener( [<span class="number">2</span>]</span><br><span class="line">        'didFoundDevice',</span><br><span class="line">        data =&gt; &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">        &#125;,</span><br><span class="line">    );</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        <span class="type">BLEManager</span>.startScanning(); [<span class="number">3</span>]</span><br><span class="line">    &#125;, <span class="number">3000</span>); <span class="comment">// Just to make sure the Bluetooth is on, we will improve it later</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[1] Create a new NativeEventEmitter instance and listen to the <code>didFoundDevice</code> event [2]<br>[3] Because we do not support the Bluetooth state changes event yet, so we temporarily delay 3s before calling scanning just to make sure the Bluetooth is on. We will improve it later by supporting more events and methods.</p>
<p>OK, let’s build and run your project. If you see your console log print the results from the scanning process, congratulation, you make it right!<br><img src="/Post-Resources/RN-BLE/Scan-Result.png" alt=""></p>
<h3 id="Next-step"><a href="#Next-step" class="headerlink" title="Next step"></a>Next step</h3><p>In this post, I showed you how to create a BLE framework and how to use a BLE native module in a React Native project such as invoking a method from Javascript to Swift and handling an event from Swift to Javascript. In the next tutorial, we will do the same on Android platform.<br>If you face any troubles, feel free to contact me. I would love to help.<br>Happy holiday.</p>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><p>[1] <a href="https://reactnative.dev/docs/native-modules-ios">React Native - Native module ios</a></p>
</div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5e9474199d6bcc0012d5bba6&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://ko-fi.com/uynguyen" style="background-color:rgba(255,128,62,.87);border-color:transparent;color:white;" target="_blank" rel="noopener"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button is-warning donate" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="uynguyen.itus@gmail.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/13/Series-React-Native-and-BLE-Part-2-Building-BLE-framework-for-Android/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Series React Native and BLE: Part 2 - Building BLE framework for Android</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/08/06/Silent-notification/"><span class="level-item">Silent notification</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://uynguyen.github.io/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/';
            this.page.identifier = '2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'uynguyen-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen"></figure><p class="title is-size-4 is-block line-height-inherit">Uy Nguyen</p><p class="is-size-6 is-block">Software engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-envelope mr-1"></i><span>uynguyen.itus@gmail.com</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">56</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">33</p></a></div></div></nav><div class="level"><a class="level-item button is-rounded" style="background-color:#f14668e3;color:white;font-weight:bold;" href="https://ko-fi.com/uynguyen" target="_blank" rel="noopener">if 👍 then Buy me a Coffee</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/uynguyen"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://www.linkedin.com/in/uynguyen505"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://uynguyen.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Uy Nguyen</span></span><span class="level-right"><span class="level-item tag">uynguyen.github.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-31T03:38:32.000Z">2024-08-31</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/31/Bluetooth-security-Pairing-and-Bonding/">Bluetooth security: Pairing and Bonding</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-04T05:10:39.000Z">2024-08-04</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/04/Android-Bluetooth-A-Pitfall/">Android Bluetooth: A Pitfall</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-06-30T03:48:09.000Z">2024-06-30</time></p><p class="title is-6"><a class="link-muted" href="/2024/06/30/Best-practice-iOS-vs-Android-Bluetooth/">Best practice: iOS vs Android Bluetooth</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-03-23T03:54:36.081Z">2024-03-23</time></p><p class="title is-6"><a class="link-muted" href="/2024/03/23/Core-Bluetooth-on-WatchOS/">Core Bluetooth on WatchOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-01-12T09:07:40.000Z">2024-01-12</time></p><p class="title is-6"><a class="link-muted" href="/2024/01/12/Protobuf/">Protobuf In Practice</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Appclip/"><span class="tag">Appclip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLE/"><span class="tag">BLE</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bluetooth/"><span class="tag">Bluetooth</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Books/"><span class="tag">Books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cocoa/"><span class="tag">Cocoa</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Concurrency/"><span class="tag">Concurrency</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Conference/"><span class="tag">Conference</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Core-Data/"><span class="tag">Core Data</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CoreBluetooh/"><span class="tag">CoreBluetooh</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CrossPlatform/"><span class="tag">CrossPlatform</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Design-Patterns/"><span class="tag">Design Patterns</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DispatchQueue/"><span class="tag">DispatchQueue</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memory-management/"><span class="tag">Memory management</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Notification/"><span class="tag">Notification</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Objective-C/"><span class="tag">Objective-C</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operations/"><span class="tag">Operations</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ReactNative/"><span class="tag">ReactNative</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Architecture/"><span class="tag">Software Architecture</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Study/"><span class="tag">Study</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UI/"><span class="tag">UI</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UIStackView/"><span class="tag">UIStackView</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UML/"><span class="tag">UML</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vendor/"><span class="tag">Vendor</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WatchOS/"><span class="tag">WatchOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Bluetooth/"><span class="tag">Web Bluetooth</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/books/"><span class="tag">books</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iBeacon/"><span class="tag">iBeacon</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/Post-Resources/UyNguyen.jpg" alt="Uy Nguyen" height="28"></a><p class="size-small"><span>&copy; Uy Nguyen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://uynguyen.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>