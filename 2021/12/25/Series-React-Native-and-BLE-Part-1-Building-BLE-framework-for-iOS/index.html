<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Series React Native and BLE: Part 1 - Building BLE framework for iOS | Uy Nguyen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the commu">
<meta property="og:type" content="article">
<meta property="og:title" content="Series React Native and BLE: Part 1 - Building BLE framework for iOS">
<meta property="og:url" content="https://uynguyen.github.io/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/index.html">
<meta property="og:site_name" content="Uy Nguyen">
<meta property="og:description" content="I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the commu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/cover1.png">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/ios_create_project.png">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/ios_build_distribution.png">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/ios_build_result.png">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/bridging-header.png">
<meta property="og:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/Scan-Result.png">
<meta property="article:published_time" content="2021-12-25T11:16:08.000Z">
<meta property="article:modified_time" content="2024-03-23T03:54:36.082Z">
<meta property="article:author" content="Uy Nguyen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uynguyen.github.io/Post-Resources/RN-BLE/cover1.png">
  
    <link rel="alternate" href="/atom.xml" title="Uy Nguyen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Uy Nguyen</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Be a Software Engineer, not a Coder.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://uynguyen.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/" class="article-date">
  <time datetime="2021-12-25T11:16:08.000Z" itemprop="datePublished">2021-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Series React Native and BLE: Part 1 - Building BLE framework for iOS
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/Post-Resources/RN-BLE/cover1.png" alt=""></p>
<p>I have been working in mobile development on both native projects and cross platforms (React Native, Flutter), and I also have experience working on BLE. Sometimes I get emails asking about the communication of RN/Flutter to BLE. Thus, I decided to introduce this series React Native and BLE to guide you on how to develop a native BLE framework and connect it to React Native.<br>Of course, there will be another series for Flutter and BLE after finishing the series of React Native.<br>In this series, I will guide you through a completed process from development to distribution.</p>
<a id="more"></a>

<ul>
<li>Create an iOS / Android framework.</li>
<li>Script to build and distribute your framework.</li>
<li>Import the frameworks to your React Native project.</li>
<li>Use your native framework in React Native.</li>
<li>Distribute your app.</li>
<li>And other cool stuff I want to share with you …</li>
</ul>
<p>If you love what I do, consider supporting me at <a href="https://ko-fi.com/uynguyen" target="_blank" rel="noopener">buy a coffee for Uy Nguyen</a> :)<br>Let’s go.</p>
<blockquote>
<p>Xcode 13, iOS 15, Swift 5, React 17.0.1, React Native 0.64.1.</p>
</blockquote>
<h3 id="Prepare-iOS-framework"><a href="#Prepare-iOS-framework" class="headerlink" title="Prepare iOS framework"></a>Prepare iOS framework</h3><p>The first step is creating a BLE framework. You also don’t have to create a framework, you can include your source code inside the iOS project directly if you want to.<br>However, the reason why I recommend moving all BLE logic to a framework is that it’s reusable, you can share your framework to other projects such as Flutter or Native projects without having to duplicate the logic.<br>Another reason is that it will improve the compile time of Xcode, breaking your app into several frameworks can speed up the build times. This is because the Xcode build system doesn’t have to recompile frameworks for which Swift files have not changed.</p>
<p>From the top left bar of Xcode, select <code>File &gt; New &gt; Project &gt; From the &quot;Framework &amp; Library&quot; section, select &quot;Framework&quot; &gt; Enter your framework name (I use &quot;BLEFramework&quot;)</code></p>
<p><img src="/Post-Resources/RN-BLE/ios_create_project.png" alt=""></p>
<p>Now, you can develop your BLE logic in the project you just created. I’m not going to detail implementing all single methods of the framework as it depends on your business logic and your architecture. You can find my previous tutorials to have an idea of how to implement a BLE framework. <a href="/2017/10/13/Bluetooth-Low-Energy-On-iOS/">Bluetooth Low Energy OniOS</a>, <a href="/2018/02/21/Play-Central-And-Peripheral-Roles-With-CoreBluetooth/">Play Central And Peripheral Roles With CoreBluetooth</a><br>I will take a simple method in my BLE framework as an example: the <code>startScanning</code> method.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Class: CentralManager</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @discussion Start scanning nearby peripherals and returns to the `ScanningDelegate`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startScanningFor</span><span class="params">(delegate: ScanningDelegate, <span class="built_in">filter</span>: DeviceFilter = DeviceFilter<span class="params">()</span></span></span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">//... BLE implementation.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK now we have a BLE framework, let move to the next step: Building and distributing your framework.</p>
<h3 id="Building-and-distributing"><a href="#Building-and-distributing" class="headerlink" title="Building and distributing"></a>Building and distributing</h3><p>There are many ways to distribute a framework like using <a href="/2017/09/25/Create-and-Distribute-Private-Libraries-with-Cocoapods">CocoaPod</a>, or manually by sending a complied file, etc. In this post, I will provide you with a script to turn your framework into a universal framework that hides all your logic, and can be used for both physical devices and simulators.</p>
<p>Make sure you turn “Build Libraries for Distribution” flag in the “Build Settings” to <code>YES</code>. The flag indicates that the compiler should generate one of the stable interfaces so the framework can be used when newer versions of Xcode or the Swift compiler are released.</p>
<p><img src="/Post-Resources/RN-BLE/ios_build_distribution.png" alt=""></p>
<p>Next, create a bash file, put it in the root of the ios folder, and copy the following commands to the file. Then execute the script.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### SCRIPT TO BUILD A SWIFT UNIVERSAL FRAMEWORK</span></span><br><span class="line"></span><br><span class="line">PRODUCT_NAME=<span class="string">"REPLACE_BY_YOUR_TARGET_NAME"</span></span><br><span class="line">BUILD_CONFIGURATION=<span class="string">"Release"</span></span><br><span class="line">DERIVED_DATA_PATH=<span class="string">"<span class="variable">$(pwd)</span>/build"</span></span><br><span class="line">RELEASE_DIR=<span class="string">"<span class="variable">$(pwd)</span>/RELEASE"</span></span><br><span class="line">BUILD_SCHEME=<span class="string">"<span class="variable">$&#123;PRODUCT_NAME&#125;</span>"</span></span><br><span class="line">FRAMEWORK_NAME=<span class="string">"<span class="variable">$&#123;PRODUCT_NAME&#125;</span>.framework"</span></span><br><span class="line"></span><br><span class="line">RELEASE_DEVICE_PATH=<span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/device/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">RELEASE_SIMULATOR_PATH=<span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/simulator/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">rm -rf <span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span></span><br><span class="line">rm -rf <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/simulator"</span></span><br><span class="line">mkdir -p <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/device"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build library for simulator</span></span><br><span class="line">fastlane ios build  scheme:<span class="string">"<span class="variable">$&#123;BUILD_SCHEME&#125;</span>"</span> \</span><br><span class="line">					configuration:<span class="string">"<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>"</span> \</span><br><span class="line">					sdk:iphonesimulator \</span><br><span class="line">					build_dir:<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>"</span> \</span><br><span class="line">					--verbose</span><br><span class="line"></span><br><span class="line">SIMULATOR_FRAMEWORK_PATH=<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>/Build/Products/<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>-iphonesimulator/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$&#123;SIMULATOR_FRAMEWORK_PATH&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;RELEASE_SIMULATOR_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build library for iphoneos</span></span><br><span class="line">fastlane ios build  scheme:<span class="string">"<span class="variable">$&#123;BUILD_SCHEME&#125;</span>"</span> \</span><br><span class="line">					configuration:<span class="string">"<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>"</span> \</span><br><span class="line">					sdk:iphoneos \</span><br><span class="line">					build_dir:<span class="string">"<span class="variable">$DERIVED_DATA_PATH</span>"</span> \</span><br><span class="line">					--verbose</span><br><span class="line"></span><br><span class="line">DEVICE_FRAMEWORK_PATH=<span class="string">"<span class="variable">$&#123;DERIVED_DATA_PATH&#125;</span>/Build/Products/<span class="variable">$&#123;BUILD_CONFIGURATION&#125;</span>-iphoneos/<span class="variable">$&#123;FRAMEWORK_NAME&#125;</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$&#123;DEVICE_FRAMEWORK_PATH&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;RELEASE_DEVICE_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Merge SDKs</span></span><br><span class="line">xcodebuild -create-xcframework -output <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>/<span class="variable">$&#123;PRODUCT_NAME&#125;</span>.xcframework"</span> \</span><br><span class="line">  -framework <span class="string">"<span class="variable">$&#123;RELEASE_DEVICE_PATH&#125;</span>"</span> \</span><br><span class="line">  -framework <span class="string">"<span class="variable">$&#123;RELEASE_SIMULATOR_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">open <span class="string">"<span class="variable">$&#123;RELEASE_DIR&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p>Once you run the script successfully, you should see the result as below</p>
<p><img src="/Post-Resources/RN-BLE/ios_build_result.png" alt=""></p>
<p>In which:</p>
<ul>
<li><code>YOUR_TARGET_NAME.xcframework</code>: The universal framework can be used for both physical devices and simulators.</li>
<li>device folder: contains <code>YOUR_TARGET_NAME.framework</code> which can be used only on physical devices.</li>
<li>simulator folder: contains <code>YOUR_TARGET_NAME.framework</code> which can be used only on simulators.</li>
</ul>
<p>Now we have a BLE framework for our application, let’s move to the next step - Create a new React Native project.</p>
<h3 id="Init-React-Native-project"><a href="#Init-React-Native-project" class="headerlink" title="Init React Native project"></a>Init React Native project</h3><p>To create a React Native project without using Expo (I recommend to not using Expo because we’re going to add a lot of Native code for Android and iOS to our project, for more details you can refer to <a href="https://stackoverflow.com/questions/39170622/what-is-the-difference-between-expo-and-react-native" target="_blank" rel="noopener">what is the difference between expo and react native</a>), open terminal and type</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init projectName</span><br></pre></td></tr></table></figure>

<p>Wait a while to set up your project. After running successfully, you should see the folder structure as below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|---projectName</span><br><span class="line">    |---ios</span><br><span class="line">        |---projectName.xcworkspace</span><br><span class="line">    |---android</span><br><span class="line">    |---...Other files, folders</span><br></pre></td></tr></table></figure>

<p>Open the <code>projectName.xcworkspace</code> file, we will config the native code in the next step.</p>
<h3 id="Wire-them-together"><a href="#Wire-them-together" class="headerlink" title="Wire them together"></a>Wire them together</h3><p>First, drag and drop the <code>YOUR_TARGET_NAME.xcframework</code> to your Xcode workspace.<br>As my SDK is built in Swift, I’m going to create a Swift class as a bridge so that we can communicate from the SDK to React Native.<br>From Xcode project, select <code>File &gt; New &gt; File &gt; Swift File &gt; Enter your file name (e.g BLEManager) &gt; Add</code>. A dialog will pop up to ask if you want to create a bridging header, select yes.</p>
<blockquote>
<p>For those who don’t know what the bridging header is used for, the bridging header is where you define all the Objective-C classes that are exposed to Swift.</p>
</blockquote>
<p><img src="/Post-Resources/RN-BLE/bridging-header.png" alt=""></p>
<p>To use RCT classes, make sure you <code>#import</code> all related headers to your <code>...-Bridging-Header.h</code>. Otherwise, you will get complied errors.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;React/RCTBridgeModule.h&gt;</span><br><span class="line">#<span class="keyword">import</span> "React/RCTEventEmitter.h"</span><br><span class="line">#<span class="keyword">import</span> "React/RCTViewManager.h"</span><br><span class="line">#<span class="keyword">import</span> &lt;React/RCTLog.h&gt;</span><br></pre></td></tr></table></figure>

<p>Next, add the interface <code>RCTEventEmitter</code> to the class <code>BLEManager</code> we just created in the previous step.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span>(<span class="type">BLEManager</span>) &lt;--- <span class="type">Remember</span> to add this [<span class="number">1</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BLEManager</span>: <span class="title">RCTEventEmitter</span>, <span class="title">ScanningDelegate</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> didFoundDeviceEvent = <span class="string">"didFoundDevice"</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@objc</span> &lt;--- <span class="type">Remember</span> to add this</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">BLEManager</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    <span class="number">_</span> = <span class="type">BLEWrapper</span>.shared</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@objc</span>(startScanning) &lt;--- <span class="type">Remember</span> to add this</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">startScanning</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">BLEWrapper</span>.shared.startScanning(<span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">managerDidFoundDevice</span><span class="params">(<span class="number">_</span> manager: CentralManager, device: Device, rssi: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.sendEvent(withName: <span class="type">Self</span>.didFoundDeviceEvent, body: [<span class="string">"name"</span>: device.localName, <span class="string">"rssi"</span>: rssi]) [<span class="number">2</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requiresMainQueueSetup</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedEvents</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>]! &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="type">Self</span>.didFoundDeviceEvent] [<span class="number">3</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[1] Make sure you decorate your class and functions by the <code>@objc</code> keyword to ensure the class and functions are exported properly to the Objective-C runtime.<br>[2] Once a peripheral is discovered, send an event to Javascript.<br>[3] Register supported the event from the native module.</p>
<p>Finally, to expose the methods of your native module, create a new file <code>BLEManager.m</code> and add the following code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface <span class="type">RCT_EXTERN_MODULE</span>(<span class="type">BLEManager</span>, <span class="type">RCTViewManager</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">RCT_EXTERN_METHOD</span>(startScanning)</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>That’s all. Javacsript now can invoke the <code>startScanning</code> function and listen to the <code>didFoundDeviceEvent</code> event.</p>
<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><p>It’s time to test our implementation, React Native provides <code>NativeEventEmitter</code> and <code>NativeModules</code> instances that allow you to work with native modules.<br>from the root folder, open <code>App.js</code> and import the necessary things. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="type">NativeEventEmitter</span>,</span><br><span class="line">  <span class="type">NativeModules</span>,</span><br><span class="line">&#125; from 'react-native';</span><br><span class="line">const &#123;<span class="type">BLEManager</span>&#125; = <span class="type">NativeModules</span>; &lt;-- <span class="type">You</span> can then access the <span class="type">BLEManager</span> native module</span><br></pre></td></tr></table></figure>

<p>In <code>componentDidMount</code> method, add the following to it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">let</span> beaconManagerEmitter = new <span class="type">NativeEventEmitter</span>(<span class="type">BLEManager</span>); [<span class="number">1</span>]</span><br><span class="line">    this.didFoundDevice = beaconManagerEmitter.addListener( [<span class="number">2</span>]</span><br><span class="line">        'didFoundDevice',</span><br><span class="line">        data =&gt; &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">        &#125;,</span><br><span class="line">    );</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        <span class="type">BLEManager</span>.startScanning(); [<span class="number">3</span>]</span><br><span class="line">    &#125;, <span class="number">3000</span>); <span class="comment">// Just to make sure the Bluetooth is on, we will improve it later</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[1] Create a new NativeEventEmitter instance and listen to the <code>didFoundDevice</code> event [2]<br>[3] Because we do not support the Bluetooth state changes event yet, so we temporarily delay 3s before calling scanning just to make sure the Bluetooth is on. We will improve it later by supporting more events and methods.</p>
<p>OK, let’s build and run your project. If you see your console log print the results from the scanning process, congratulation, you make it right!<br><img src="/Post-Resources/RN-BLE/Scan-Result.png" alt=""></p>
<h3 id="Next-step"><a href="#Next-step" class="headerlink" title="Next step"></a>Next step</h3><p>In this post, I showed you how to create a BLE framework and how to use a BLE native module in a React Native project such as invoking a method from Javascript to Swift and handling an event from Swift to Javascript. In the next tutorial, we will do the same on Android platform.<br>If you face any troubles, feel free to contact me. I would love to help.<br>Happy holiday.</p>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><p>[1] <a href="https://reactnative.dev/docs/native-modules-ios" target="_blank" rel="noopener">React Native - Native module ios</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://uynguyen.github.io/2021/12/25/Series-React-Native-and-BLE-Part-1-Building-BLE-framework-for-iOS/" data-id="clu3nvc5w0025xzvq4ktlfk58" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/02/13/Series-React-Native-and-BLE-Part-2-Building-BLE-framework-for-Android/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Series React Native and BLE: Part 2 - Building BLE framework for Android
        
      </div>
    </a>
  
  
    <a href="/2021/08/06/Silent-notification/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Silent notification</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Appclip/" rel="tag">Appclip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BLE/" rel="tag">BLE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bluetooth/" rel="tag">Bluetooth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Books/" rel="tag">Books</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocoa/" rel="tag">Cocoa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Concurrency/" rel="tag">Concurrency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Conference/" rel="tag">Conference</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Core-Data/" rel="tag">Core Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CoreBluetooh/" rel="tag">CoreBluetooh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CrossPlatform/" rel="tag">CrossPlatform</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DispatchQueue/" rel="tag">DispatchQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory-management/" rel="tag">Memory management</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notification/" rel="tag">Notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Objective-C/" rel="tag">Objective-C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Operations/" rel="tag">Operations</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactNative/" rel="tag">ReactNative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Software-Architecture/" rel="tag">Software Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Study/" rel="tag">Study</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UIStackView/" rel="tag">UIStackView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/" rel="tag">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vendor/" rel="tag">Vendor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WatchOS/" rel="tag">WatchOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web-Bluetooth/" rel="tag">Web Bluetooth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/books/" rel="tag">books</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iBeacon/" rel="tag">iBeacon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macOS/" rel="tag">macOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 11.67px;">Android</a> <a href="/tags/Appclip/" style="font-size: 10px;">Appclip</a> <a href="/tags/BLE/" style="font-size: 18.33px;">BLE</a> <a href="/tags/Bluetooth/" style="font-size: 13.33px;">Bluetooth</a> <a href="/tags/Books/" style="font-size: 10px;">Books</a> <a href="/tags/Cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/Concurrency/" style="font-size: 15px;">Concurrency</a> <a href="/tags/Conference/" style="font-size: 10px;">Conference</a> <a href="/tags/Core-Data/" style="font-size: 10px;">Core Data</a> <a href="/tags/CoreBluetooh/" style="font-size: 11.67px;">CoreBluetooh</a> <a href="/tags/CrossPlatform/" style="font-size: 10px;">CrossPlatform</a> <a href="/tags/Design-Patterns/" style="font-size: 10px;">Design Patterns</a> <a href="/tags/DispatchQueue/" style="font-size: 10px;">DispatchQueue</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Memory-management/" style="font-size: 10px;">Memory management</a> <a href="/tags/Notification/" style="font-size: 11.67px;">Notification</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/Operations/" style="font-size: 11.67px;">Operations</a> <a href="/tags/ReactNative/" style="font-size: 10px;">ReactNative</a> <a href="/tags/Software-Architecture/" style="font-size: 10px;">Software Architecture</a> <a href="/tags/Study/" style="font-size: 11.67px;">Study</a> <a href="/tags/Swift/" style="font-size: 16.67px;">Swift</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/UIStackView/" style="font-size: 10px;">UIStackView</a> <a href="/tags/UML/" style="font-size: 10px;">UML</a> <a href="/tags/Vendor/" style="font-size: 10px;">Vendor</a> <a href="/tags/WatchOS/" style="font-size: 10px;">WatchOS</a> <a href="/tags/Web-Bluetooth/" style="font-size: 10px;">Web Bluetooth</a> <a href="/tags/books/" style="font-size: 10px;">books</a> <a href="/tags/iBeacon/" style="font-size: 11.67px;">iBeacon</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/macOS/" style="font-size: 10px;">macOS</a> <a href="/tags/study/" style="font-size: 10px;">study</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/06/30/Best-practice-iOS-vs-Android-Bluetooth/">Best practice: iOS vs Android Bluetooth</a>
          </li>
        
          <li>
            <a href="/2024/03/23/Core-Bluetooth-on-WatchOS/">Core Bluetooth on WatchOS</a>
          </li>
        
          <li>
            <a href="/2024/01/12/Protobuf/">Protobuf In Practice</a>
          </li>
        
          <li>
            <a href="/2023/11/09/What-s-new-of-Appclip-on-iOS-17/">What&#39;s new of Appclip on iOS 17?</a>
          </li>
        
          <li>
            <a href="/2023/07/22/Schedule-task-in-background-from-foreground-service/">Schedule task in background from foreground service</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Uy Nguyen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>